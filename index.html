<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Posture Analyzer - AI-Powered Posture Tracking</title>
    <meta name="description" content="Real-time AI-powered posture analysis with MediaPipe. Track spine alignment, shoulder balance, and get instant feedback to improve your posture.">
    <meta name="keywords" content="posture analyzer, AI posture, spine alignment, posture tracker, ergonomics">
    <meta property="og:title" content="Advanced Posture Analyzer">
    <meta property="og:description" content="AI-powered real-time posture detection and correction">
    <meta property="og:type" content="website">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎯</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 25%, #16213e 50%, #1a1a2e 75%, #0a0a1a 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: #e8e9f3;
            overflow-x: hidden;
            position: relative;
            line-height: 1.6;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.08) 0%, transparent 60%),
                radial-gradient(ellipse at 80% 80%, rgba(99, 102, 241, 0.08) 0%, transparent 60%),
                radial-gradient(ellipse at 40% 60%, rgba(168, 85, 247, 0.06) 0%, transparent 60%);
            pointer-events: none;
            z-index: -1;
        }

        .app-header {
            background: linear-gradient(135deg, 
                rgba(15, 23, 42, 0.95) 0%, 
                rgba(30, 41, 59, 0.95) 50%, 
                rgba(15, 23, 42, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 32px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .app-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(59, 130, 246, 0.05) 50%, transparent 70%);
            animation: shimmer 4s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        .app-header h1 {
            font-size: 2em;
            font-weight: 800;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.025em;
        }

        .app-header p {
            opacity: 0.8;
            font-size: 0.95em;
            position: relative;
            z-index: 1;
            color: #94a3b8;
            font-weight: 400;
        }

        .main-container {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 20px;
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }

        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
            }
        }

        .video-section {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.9) 0%, rgba(44, 27, 105, 0.9) 100%);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 
                0 16px 40px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .video-wrapper {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            border-radius: 12px;
            overflow: hidden;
            background: linear-gradient(135deg, #000000 0%, #1a1a2e 100%);
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.5),
                inset 0 0 0 1px rgba(102, 126, 234, 0.2);
        }

        video, canvas {
            width: 100%;
            height: auto;
            display: block;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        .control-bar {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            min-width: 130px;
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 4px 15px rgba(102, 126, 234, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        button:hover:not(:disabled)::before {
            left: 100%;
        }

        button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 
                0 8px 25px rgba(102, 126, 234, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        button.calibrate {
            background: linear-gradient(135deg, #00d4ff 0%, #5b2c87 50%, #0099cc 100%);
            box-shadow: 
                0 4px 15px rgba(0, 212, 255, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        button.calibrate:hover:not(:disabled) {
            box-shadow: 
                0 8px 25px rgba(0, 212, 255, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        button.stop {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8a80 50%, #ee5a24 100%);
            box-shadow: 
                0 4px 15px rgba(255, 107, 107, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        button.stop:hover:not(:disabled) {
            box-shadow: 
                0 8px 25px rgba(255, 107, 107, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .metrics-card {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.95) 0%, rgba(44, 27, 105, 0.95) 100%);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 
                0 12px 40px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }

        .metrics-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #00d4ff);
            animation: rainbow 3s linear infinite;
        }

        @keyframes rainbow {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .metrics-card h3 {
            font-size: 1.2em;
            margin-bottom: 18px;
            background: linear-gradient(135deg, #00d4ff, #667eea, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .metric-item {
            margin-bottom: 15px;
        }

        .metric-label {
            font-size: 0.85em;
            color: #888;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #fff;
        }

        .metric-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }

        .metric-fill {
            height: 100%;
            border-radius: 3px;
            transition: all 0.5s ease;
        }

        .score-display {
            text-align: center;
            padding: 28px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 50%, rgba(240, 147, 251, 0.3) 100%);
            border-radius: 16px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 8px 32px rgba(102, 126, 234, 0.2),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }

        .score-display::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #00d4ff);
            border-radius: 16px;
            z-index: -1;
            animation: rotate 4s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .score-value {
            font-size: 3.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .score-label {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .good { color: #00ff88; }
        .fair { color: #ffcc00; }
        .poor { color: #ff4444; }

        .alert-box {
            background: rgba(255, 193, 7, 0.1);
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .alert-box.error {
            background: rgba(255, 68, 68, 0.1);
            border-left-color: #ff4444;
        }

        .alert-box.success {
            background: rgba(0, 255, 136, 0.1);
            border-left-color: #00ff88;
        }

        .history-chart {
            height: 120px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 10px;
            position: relative;
            overflow: hidden;
        }

        .chart-line {
            stroke: #00d4ff;
            stroke-width: 2;
            fill: none;
        }

        .chart-area {
            fill: url(#gradient);
            opacity: 0.3;
        }

        .tips-section {
            background: #1a1a2e;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .tips-section h3 {
            color: #00d4ff;
            margin-bottom: 15px;
        }

        .tip-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .tip-icon {
            margin-right: 10px;
            color: #00ff88;
            font-size: 1.2em;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .realtime-feedback {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            z-index: 10;
        }

        .skeleton-overlay {
            pointer-events: none;
        }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.3);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 300px;
            font-size: 0.9em;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            box-shadow: 0 4px 20px rgba(0, 255, 136, 0.3);
        }

        .notification.warning {
            background: linear-gradient(135deg, #ffcc00 0%, #ff9900 100%);
            box-shadow: 0 4px 20px rgba(255, 204, 0, 0.3);
        }

        /* Achievement badge */
        .achievement-badge {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #ffd700 0%, #ffb700 100%);
            color: #333;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            z-index: 1001;
            transition: transform 0.3s ease;
            box-shadow: 0 8px 32px rgba(255, 215, 0, 0.4);
        }

        .achievement-badge.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .achievement-badge h3 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        /* Fullscreen button */
        .fullscreen-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            color: white;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            z-index: 10;
        }

        .fullscreen-btn:hover {
            background: rgba(0, 0, 0, 0.9);
        }

        /* Settings Panel */
        .settings-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100vh;
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.95) 0%, rgba(44, 27, 105, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(255,255,255,0.1);
            padding: 30px;
            z-index: 1000;
            transition: right 0.3s ease;
            overflow-y: auto;
        }

        .settings-panel.open {
            right: 0;
        }

        .settings-panel h2 {
            color: #f093fb;
            margin-bottom: 30px;
            font-size: 1.5em;
            font-weight: 700;
        }

        .setting-group {
            margin-bottom: 25px;
        }

        .setting-label {
            display: block;
            color: #e0e0e0;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .setting-input {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 14px;
        }

        .setting-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: rgba(255,255,255,0.2);
            border-radius: 24px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .switch.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .switch::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .switch.active::before {
            transform: translateX(26px);
        }

        .settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            z-index: 1001;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .settings-btn:hover {
            transform: rotate(90deg);
            transition: transform 0.3s;
        }

        /* Break Reminder Modal */
        .break-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .break-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .break-modal-content {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.95) 0%, rgba(44, 27, 105, 0.95) 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            margin: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .break-modal h3 {
            color: #f093fb;
            font-size: 1.8em;
            margin-bottom: 20px;
        }

        .break-modal p {
            color: #e0e0e0;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .break-exercises {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .exercise-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .exercise-item .emoji {
            font-size: 2em;
            margin-bottom: 8px;
            display: block;
        }

        .exercise-item .name {
            font-size: 0.9em;
            color: #e0e0e0;
        }

        /* Session History */
        .history-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-date {
            color: #888;
            font-size: 0.9em;
        }

        .history-score {
            font-weight: bold;
        }

        /* Navigation Styles */
        .header-nav {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 24px;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            padding: 6px;
            border: 1px solid rgba(59, 130, 246, 0.1);
            max-width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }

        .nav-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            background: transparent;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
            font-weight: 500;
            min-width: auto;
            flex: none;
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: 25px;
        }

        .nav-btn:hover:not(.active) {
            color: #e2e8f0;
            background: rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
            font-weight: 600;
        }

        .nav-btn.active::before {
            opacity: 1;
        }

        /* Page Content */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* Sign Up Page Styles */
        .signup-container {
            max-width: 1200px;
            width: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: start;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .signup-form {
            background: linear-gradient(135deg, 
                rgba(15, 23, 42, 0.95) 0%, 
                rgba(30, 41, 59, 0.95) 50%, 
                rgba(15, 23, 42, 0.95) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .signup-form::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(59, 130, 246, 0.05) 50%, transparent 70%);
            animation: shimmer 4s ease-in-out infinite;
        }

        .signup-form h2 {
            font-size: 2em;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
        }

        .signup-form p {
            text-align: center;
            opacity: 0.8;
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
            color: #94a3b8;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #cbd5e1;
            font-weight: 500;
        }

        .form-group input[type="text"], 
        .form-group input[type="email"], 
        .form-group input[type="password"] {
            width: 100%;
            padding: 12px 16px;
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 10px;
            color: #e8e9f3;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input[type="text"]:focus, 
        .form-group input[type="email"]:focus, 
        .form-group input[type="password"]:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .signup-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-top: 10px;
            position: relative;
            z-index: 1;
        }

        .signup-btn:hover {
            transform: translateY(-2px);
        }

        .stats-panel {
            background: linear-gradient(135deg, 
                rgba(15, 23, 42, 0.95) 0%, 
                rgba(30, 41, 59, 0.95) 50%, 
                rgba(15, 23, 42, 0.95) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .stats-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .stats-header h3 {
            font-size: 1.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid rgba(59, 130, 246, 0.1);
        }

        .stat-label {
            color: #cbd5e1;
            font-weight: 500;
        }

        .stat-value {
            font-weight: 700;
            font-size: 1.2em;
            color: #3b82f6;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .user-list {
            margin-top: 30px;
        }

        .user-list h4 {
            color: #cbd5e1;
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: 600;
        }

        .user-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid rgba(59, 130, 246, 0.1);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-right: 12px;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            color: #e8e9f3;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .user-status {
            color: #94a3b8;
            font-size: 0.85em;
        }

        .online-indicator {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            margin-left: auto;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .live-counter {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .live-counter .counter-number {
            font-size: 2em;
            font-weight: 800;
            color: #10b981;
            display: block;
            margin-bottom: 5px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .live-counter .counter-label {
            color: #94a3b8;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .signup-container {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .signup-form, .stats-panel {
                padding: 30px 20px;
            }
        }

        /* Exercise specific styles */
        .rep-counter, .plank-timer {
            font-size: 4em;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            background: linear-gradient(135deg, #00ff88, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .exercise-status {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 1.2em;
            font-weight: 600;
        }

        .exercise-status.up {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 212, 255, 0.2));
            color: #00ff88;
        }

        .exercise-status.down {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(238, 90, 36, 0.2));
            color: #ff6b6b;
        }

        .exercise-status.ready {
            background: linear-gradient(135deg, rgba(255, 204, 0, 0.2), rgba(255, 153, 0, 0.2));
            color: #ffcc00;
        }
    </style>
</head>
<body>
    <div class="app-header">
        <nav class="header-nav">
            <button id="postureNavBtn" class="nav-btn active">🎯 Posture</button>
            <button id="pushupNavBtn" class="nav-btn">💪 Push-ups</button>
            <button id="squatNavBtn" class="nav-btn">🏋️ Squats</button>
            <button id="plankNavBtn" class="nav-btn">🤸 Plank</button>
            <button id="aboutNavBtn" class="nav-btn">ℹ️ About</button>
            <button id="helpNavBtn" class="nav-btn">❓ Help</button>
            <button id="signupNavBtn" class="nav-btn">👤 Sign Up</button>
        </nav>
        <div id="pageTitle">
            <h1>🎯 Advanced Posture Analyzer</h1>
            <p>AI-powered real-time posture detection and spine alignment monitoring</p>
        </div>
    </div>

    <!-- Posture Page -->
    <div id="posturePage" class="page-content active">
        <div class="main-container">
            <div class="video-section">
                <div class="video-wrapper">
                    <video id="video" autoplay muted></video>
                    <canvas id="canvas" class="skeleton-overlay"></canvas>
                    <div id="realtimeFeedback" class="realtime-feedback" style="display:none"></div>
                    <button id="fullscreenBtn" class="fullscreen-btn" title="Toggle Fullscreen">⛶</button>
                </div>
                
                <div class="control-bar">
                    <button id="startBtn">🎥 Start Camera</button>
                    <button id="calibrateBtn" class="calibrate" disabled>📐 Calibrate Posture</button>
                    <button id="resetBtn" disabled>🔄 Reset Calibration</button>
                    <button id="stopBtn" class="stop" disabled>⏹ Stop</button>
                </div>

                <div id="statusMessage"></div>

                <div class="tips-section">
                    <h3>💡 Posture Tips</h3>
                    <div id="dynamicTips">
                        <div class="tip-item">
                            <span class="tip-icon">✓</span>
                            <span>Position your entire upper body in frame for accurate detection</span>
                        </div>
                        <div class="tip-item">
                            <span class="tip-icon">✓</span>
                            <span>Keep your shoulders relaxed and level</span>
                        </div>
                        <div class="tip-item">
                            <span class="tip-icon">✓</span>
                            <span>Align your ears over your shoulders, not forward</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="metrics-card">
                    <div class="score-display">
                        <div class="score-value" id="mainScore">--</div>
                        <div class="score-label" id="scoreLabel">Posture Score</div>
                    </div>

                    <div class="metric-item">
                        <div class="metric-label">Spine Alignment</div>
                        <div class="metric-value" id="spineAngle">--°</div>
                        <div class="metric-bar">
                            <div class="metric-fill" id="spineBar" style="width: 0%; background: linear-gradient(90deg, #00ff88, #00d4ff);"></div>
                        </div>
                    </div>

                    <div class="metric-item">
                        <div class="metric-label">Shoulder Balance</div>
                        <div class="metric-value" id="shoulderBalance">--</div>
                        <div class="metric-bar">
                            <div class="metric-fill" id="shoulderBar" style="width: 0%; background: linear-gradient(90deg, #667eea, #764ba2);"></div>
                        </div>
                    </div>

                    <div class="metric-item">
                        <div class="metric-label">Head Forward Angle</div>
                        <div class="metric-value" id="headAngle">--°</div>
                        <div class="metric-bar">
                            <div class="metric-fill" id="headBar" style="width: 0%; background: linear-gradient(90deg, #ff6b6b, #ee5a24);"></div>
                        </div>
                    </div>

                    <div class="metric-item">
                        <div class="metric-label">Confidence</div>
                        <div class="metric-value" id="confidence">--</div>
                    </div>
                </div>

                <div class="metrics-card">
                    <h3>📊 Session Statistics</h3>
                    <div class="metric-item">
                        <div class="metric-label">Average Score</div>
                        <div class="metric-value" id="avgScore">--</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Time in Good Posture</div>
                        <div class="metric-value" id="goodPostureTime">--</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Session Duration</div>
                        <div class="metric-value" id="sessionTime">00:00</div>
                    </div>
                    
                    <svg class="history-chart" id="scoreChart" viewBox="0 0 300 100">
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#00d4ff;stop-opacity:0.4" />
                                <stop offset="100%" style="stop-color:#00d4ff;stop-opacity:0" />
                            </linearGradient>
                        </defs>
                        <path id="chartPath" class="chart-area" d=""></path>
                        <path id="chartLine" class="chart-line" d=""></path>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Push-up Page -->
    <div id="pushupPage" class="page-content">
        <div class="main-container">
            <div class="video-section">
                <div class="video-wrapper">
                    <video id="pushupVideo" autoplay muted></video>
                    <canvas id="pushupCanvas" class="skeleton-overlay"></canvas>
                    <div id="pushupFeedback" class="realtime-feedback" style="display:none"></div>
                </div>
                
                <div class="rep-counter" id="pushupCounter">0</div>
                <div class="exercise-status ready" id="pushupStatus">Get ready in push-up position</div>
                
                <div class="control-bar">
                    <button id="startPushupBtn">🎥 Start Push-up Counter</button>
                    <button id="resetPushupBtn" disabled>🔄 Reset Count</button>
                    <button id="stopPushupBtn" class="stop" disabled>⏹ Stop</button>
                </div>

                <div id="pushupStatusMessage"></div>

                <div class="tips-section">
                    <h3>💪 Push-up Tips</h3>
                    <div class="tip-item">
                        <span class="tip-icon">✓</span>
                        <span>Position your whole body in frame, from head to feet</span>
                    </div>
                    <div class="tip-item">
                        <span class="tip-icon">✓</span>
                        <span>Keep your body straight like a plank</span>
                    </div>
                    <div class="tip-item">
                        <span class="tip-icon">✓</span>
                        <span>Lower chest close to ground, then push up fully</span>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="metrics-card">
                    <div class="score-display">
                        <div class="score-value" id="pushupCount">0</div>
                        <div class="score-label">Push-ups Completed</div>
                    </div>

                    <div class="metric-item">
                        <div class="metric-label">Current Set</div>
                        <div class="metric-value" id="currentSet">1</div>
                    </div>

                    <div class="metric-item">
                        <div class="metric-label">Best Set</div>
                        <div class="metric-value" id="bestSet">0</div>
                    </div>

                    <div class="metric-item">
                        <div class="metric-label">Total Today</div>
                        <div class="metric-value" id="totalToday">0</div>
                    </div>

                    <div class="metric-item">
                        <div class="metric-label">Form Quality</div>
                        <div class="metric-value" id="formQuality">--</div>
                    </div>
                </div>

                <div class="metrics-card">
                    <h3>🏆 Push-up Records</h3>
                    <div class="metric-item">
                        <div class="metric-label">Personal Best</div>
                        <div class="metric-value" id="personalBest">0</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">This Week</div>
                        <div class="metric-value" id="weeklyTotal">0</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Average/Day</div>
                        <div class="metric-value" id="dailyAverage">0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Squat Page -->
    <div id="squatPage" class="page-content">
        <div class="main-container">
            <div class="video-section">
                <div class="video-wrapper">
                    <video id="squatVideo" autoplay muted></video>
                    <canvas id="squatCanvas" class="skeleton-overlay"></canvas>
                    <div id="squatFeedback" class="realtime-feedback" style="display:none"></div>
                </div>
                
                <div class="rep-counter" id="squatCounter">0</div>
                <div class="exercise-status ready" id="squatStatus">Stand up straight to begin</div>
                
                <div class="control-bar">
                    <button id="startSquatBtn">🎥 Start Squat Counter</button>
                    <button id="resetSquatBtn" disabled>🔄 Reset Count</button>
                    <button id="stopSquatBtn" class="stop" disabled>⏹ Stop</button>
                </div>
            </div>
            
            <div class="metrics-section">
                <div class="metrics-card">
                    <h3>📊 Squat Analytics</h3>
                    
                    <div class="metric-item">
                        <span class="metric-label">Total Squats</span>
                        <span class="metric-value" id="squatTotal">0</span>
                    </div>
                    
                    <div class="metric-item">
                        <span class="metric-label">Current Session</span>
                        <span class="metric-value" id="squatSession">0</span>
                    </div>
                    
                    <div class="metric-item">
                        <span class="metric-label">Best Session</span>
                        <span class="metric-value" id="squatBest">0</span>
                    </div>
                    
                    <div class="metric-item">
                        <span class="metric-label">Form Score</span>
                        <span class="metric-value" id="squatFormScore">--</span>
                    </div>
                    
                    <div class="metric-item">
                        <span class="metric-label">Depth Quality</span>
                        <span class="metric-value" id="squatDepth">--</span>
                    </div>
                </div>
                
                <div class="tips-section">
                    <h4>💡 Squat Tips</h4>
                    <ul>
                        <li>Keep your feet shoulder-width apart</li>
                        <li>Lower until thighs are parallel to floor</li>
                        <li>Keep your chest up and core engaged</li>
                        <li>Push through your heels to stand up</li>
                        <li>Maintain steady breathing throughout</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Plank Page -->
    <div id="plankPage" class="page-content">
        <div class="main-container">
            <div class="video-section">
                <div class="video-wrapper">
                    <video id="plankVideo" autoplay muted></video>
                    <canvas id="plankCanvas" class="skeleton-overlay"></canvas>
                    <div id="plankFeedback" class="realtime-feedback" style="display:none"></div>
                </div>
                
                <div class="plank-timer" id="plankTimer">00:00</div>
                <div class="exercise-status ready" id="plankStatus">Get into plank position to begin</div>
                
                <div class="control-bar">
                    <button id="startPlankBtn">🎥 Start Plank Timer</button>
                    <button id="resetPlankBtn" disabled>🔄 Reset Timer</button>
                    <button id="stopPlankBtn" class="stop" disabled>⏹ Stop</button>
                </div>
            </div>
            
            <div class="metrics-section">
                <div class="metrics-card">
                    <h3>📊 Plank Analytics</h3>
                    
                    <div class="metric-item">
                        <span class="metric-label">Current Time</span>
                        <span class="metric-value" id="plankCurrent">00:00</span>
                    </div>
                    
                    <div class="metric-item">
                        <span class="metric-label">Best Time</span>
                        <span class="metric-value" id="plankBest">00:00</span>
                    </div>
                    
                    <div class="metric-item">
                        <span class="metric-label">Total Time</span>
                        <span class="metric-value" id="plankTotal">00:00</span>
                    </div>
                    
                    <div class="metric-item">
                        <span class="metric-label">Form Score</span>
                        <span class="metric-value" id="plankFormScore">--</span>
                    </div>
                    
                    <div class="metric-item">
                        <span class="metric-label">Stability</span>
                        <span class="metric-value" id="plankStability">--</span>
                    </div>
                </div>
                
                <div class="tips-section">
                    <h4>💡 Plank Tips</h4>
                    <ul>
                        <li>Keep your body in a straight line</li>
                        <li>Engage your core throughout</li>
                        <li>Don't let your hips sag or pike up</li>
                        <li>Keep your head in neutral position</li>
                        <li>Breathe steadily, don't hold breath</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- About Page -->
    <div id="aboutPage" class="page-content">
        <div class="main-container" style="grid-template-columns: 1fr;">
            <div class="video-section">
                <div style="max-width: 800px; margin: 0 auto; padding: 40px;">
                    <div class="metrics-card">
                        <h2 style="color: #3b82f6; margin-bottom: 30px; text-align: center;">About FitTrack AI</h2>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin-bottom: 40px;">
                            <div style="text-align: center;">
                                <div style="font-size: 3em; margin-bottom: 15px;">🎯</div>
                                <h3 style="color: #8b5cf6; margin-bottom: 10px;">Our Mission</h3>
                                <p style="color: #94a3b8; line-height: 1.6;">To make fitness tracking accessible and fun using cutting-edge AI technology that helps you achieve your health goals.</p>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 3em; margin-bottom: 15px;">🧠</div>
                                <h3 style="color: #8b5cf6; margin-bottom: 10px;">AI Technology</h3>
                                <p style="color: #94a3b8; line-height: 1.6;">Powered by Google's MediaPipe, our AI provides real-time pose detection and form analysis for accurate fitness tracking.</p>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 3em; margin-bottom: 15px;">🔒</div>
                                <h3 style="color: #8b5cf6; margin-bottom: 10px;">Privacy First</h3>
                                <p style="color: #94a3b8; line-height: 1.6;">All processing happens locally in your browser. Your video data never leaves your device.</p>
                            </div>
                        </div>

                        <div style="background: rgba(59, 130, 246, 0.1); border-radius: 12px; padding: 30px; text-align: center;">
                            <h3 style="color: #3b82f6; margin-bottom: 20px;">✨ Features</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                                <div>
                                    <strong style="color: #e2e8f0;">Posture Analysis</strong>
                                    <p style="color: #94a3b8; font-size: 0.9em; margin-top: 5px;">Real-time spine alignment monitoring</p>
                                </div>
                                <div>
                                    <strong style="color: #e2e8f0;">Exercise Tracking</strong>
                                    <p style="color: #94a3b8; font-size: 0.9em; margin-top: 5px;">AI-powered push-up and workout counting</p>
                                </div>
                                <div>
                                    <strong style="color: #e2e8f0;">Form Analysis</strong>
                                    <p style="color: #94a3b8; font-size: 0.9em; margin-top: 5px;">Get feedback on your exercise form</p>
                                </div>
                                <div>
                                    <strong style="color: #e2e8f0;">Progress Tracking</strong>
                                    <p style="color: #94a3b8; font-size: 0.9em; margin-top: 5px;">Historical data and analytics</p>
                                </div>
                            </div>
                        </div>

                        <div style="text-align: center; margin-top: 40px; color: #64748b;">
                            <p>Built with ❤️ using modern web technologies</p>
                            <p style="margin-top: 10px; font-size: 0.9em;">MediaPipe • WebRTC • Canvas API • Local Storage</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Page -->
    <div id="helpPage" class="page-content">
        <div class="main-container" style="grid-template-columns: 1fr;">
            <div class="video-section">
                <div style="max-width: 800px; margin: 0 auto; padding: 40px;">
                    <div class="metrics-card">
                        <h2 style="color: #3b82f6; margin-bottom: 30px; text-align: center;">❓ Help & FAQ</h2>
                        
                        <div class="faq-section">
                            <div class="faq-item" style="margin-bottom: 30px; border-bottom: 1px solid rgba(59, 130, 246, 0.1); padding-bottom: 20px;">
                                <h3 style="color: #8b5cf6; margin-bottom: 10px;">🎥 How do I start using FitTrack AI?</h3>
                                <p style="color: #94a3b8; line-height: 1.6;">
                                    1. Click on any exercise tab (Posture, Push-ups, etc.)<br>
                                    2. Click "Start Camera" and allow camera permissions<br>
                                    3. Position yourself in frame and start exercising!
                                </p>
                            </div>

                            <div class="faq-item" style="margin-bottom: 30px; border-bottom: 1px solid rgba(59, 130, 246, 0.1); padding-bottom: 20px;">
                                <h3 style="color: #8b5cf6; margin-bottom: 10px;">🔒 Is my video data safe?</h3>
                                <p style="color: #94a3b8; line-height: 1.6;">
                                    Yes! All processing happens locally in your browser using your device's computing power. 
                                    Your video stream never leaves your device or gets uploaded anywhere.
                                </p>
                            </div>

                            <div class="faq-item" style="margin-bottom: 30px; border-bottom: 1px solid rgba(59, 130, 246, 0.1); padding-bottom: 20px;">
                                <h3 style="color: #8b5cf6; margin-bottom: 10px;">💪 How does push-up counting work?</h3>
                                <p style="color: #94a3b8; line-height: 1.6;">
                                    Our AI tracks your arm and body position to detect when you complete a full push-up. 
                                    Make sure your whole body is visible in the frame for best results.
                                </p>
                            </div>

                            <div class="faq-item" style="margin-bottom: 30px; border-bottom: 1px solid rgba(59, 130, 246, 0.1); padding-bottom: 20px;">
                                <h3 style="color: #8b5cf6; margin-bottom: 10px;">⚙️ Can I customize settings?</h3>
                                <p style="color: #94a3b8; line-height: 1.6;">
                                    Yes! Click the settings gear (⚙️) in the top-right corner to adjust break reminders, 
                                    themes, sensitivity, and export your data.
                                </p>
                            </div>

                            <div class="faq-item" style="margin-bottom: 30px; border-bottom: 1px solid rgba(59, 130, 246, 0.1); padding-bottom: 20px;">
                                <h3 style="color: #8b5cf6; margin-bottom: 10px;">📱 System Requirements</h3>
                                <p style="color: #94a3b8; line-height: 1.6;">
                                    • Modern web browser (Chrome, Firefox, Safari, Edge)<br>
                                    • Webcam access<br>
                                    • Stable internet connection (for initial loading)<br>
                                    • Good lighting for optimal AI detection
                                </p>
                            </div>

                            <div class="faq-item" style="margin-bottom: 20px;">
                                <h3 style="color: #8b5cf6; margin-bottom: 10px;">🚨 Troubleshooting</h3>
                                <p style="color: #94a3b8; line-height: 1.6;">
                                    <strong>Camera won't start:</strong> Check browser permissions and ensure no other app is using the camera<br>
                                    <strong>Poor detection:</strong> Ensure good lighting and full body visibility<br>
                                    <strong>Counting issues:</strong> Move slowly and maintain proper form for better tracking
                                </p>
                            </div>
                        </div>

                        <div style="background: rgba(139, 92, 246, 0.1); border-radius: 12px; padding: 30px; text-align: center; margin-top: 30px;">
                            <h3 style="color: #8b5cf6; margin-bottom: 15px;">Need More Help?</h3>
                            <p style="color: #94a3b8; margin-bottom: 20px;">Still have questions? We're here to help!</p>
                            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                                <a href="mailto:support@fittrack.ai" style="color: #3b82f6; text-decoration: none; padding: 10px 20px; border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 25px; transition: all 0.3s ease;">
                                    📧 Email Support
                                </a>
                                <a href="#" onclick="alert('Documentation coming soon!')" style="color: #8b5cf6; text-decoration: none; padding: 10px 20px; border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 25px; transition: all 0.3s ease;">
                                    📚 Documentation
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sign Up Page -->
    <div id="signupPage" class="page-content">
        <div class="signup-container">
            <div class="signup-form">
                <h2>Join Our Community</h2>
                <p>Start your posture improvement journey today</p>
                
                <form id="signupForm">
                    <div class="form-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" name="fullName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <input type="password" id="confirmPassword" name="confirmPassword" required>
                    </div>
                    
                    <button type="submit" class="signup-btn">Create Account</button>
                </form>
            </div>
            
            <div class="stats-panel">
                <div class="stats-header">
                    <h3>Community Stats</h3>
                    <p style="color: #94a3b8; margin: 0;">Real-time user activity</p>
                </div>
                
                <div class="live-counter">
                    <span class="counter-number" id="liveUsers">247</span>
                    <span class="counter-label">Users Online Now</span>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">Total Users</span>
                    <span class="stat-value" id="totalUsers">12,847</span>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">Sessions Today</span>
                    <span class="stat-value" id="todaySessions">3,291</span>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">Posture Improvements</span>
                    <span class="stat-value" id="improvements">89,234</span>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">Average Score</span>
                    <span class="stat-value">87%</span>
                </div>
                
                <div class="user-list">
                    <h4>Recently Joined</h4>
                    
                    <div class="user-item">
                        <div class="user-avatar">A</div>
                        <div class="user-info">
                            <div class="user-name">Alex Chen</div>
                            <div class="user-status">Joined 2 minutes ago</div>
                        </div>
                        <div class="online-indicator"></div>
                    </div>
                    
                    <div class="user-item">
                        <div class="user-avatar">S</div>
                        <div class="user-info">
                            <div class="user-name">Sarah Johnson</div>
                            <div class="user-status">Joined 8 minutes ago</div>
                        </div>
                        <div class="online-indicator"></div>
                    </div>
                    
                    <div class="user-item">
                        <div class="user-avatar">M</div>
                        <div class="user-info">
                            <div class="user-name">Mike Rodriguez</div>
                            <div class="user-status">Joined 15 minutes ago</div>
                        </div>
                        <div class="online-indicator"></div>
                    </div>
                    
                    <div class="user-item">
                        <div class="user-avatar">E</div>
                        <div class="user-info">
                            <div class="user-name">Emily Davis</div>
                            <div class="user-status">Joined 23 minutes ago</div>
                        </div>
                        <div class="online-indicator"></div>
                    </div>
                    
                    <div class="user-item">
                        <div class="user-avatar">J</div>
                        <div class="user-info">
                            <div class="user-name">James Wilson</div>
                            <div class="user-status">Joined 1 hour ago</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Button -->
    <button id="settingsBtn" class="settings-btn" title="Settings">⚙️</button>

    <!-- Settings Panel -->
    <div id="settingsPanel" class="settings-panel">
        <h2>⚙️ Settings</h2>
        
        <div class="setting-group">
            <label class="setting-label">Break Reminder</label>
            <div class="setting-toggle">
                <span>Enable break reminders every 30 minutes</span>
                <div id="breakReminderToggle" class="switch"></div>
            </div>
        </div>

        <div class="setting-group">
            <label class="setting-label">Break Interval (minutes)</label>
            <input type="number" id="breakInterval" class="setting-input" value="30" min="5" max="120">
        </div>

        <div class="setting-group">
            <label class="setting-label">Sound Notifications</label>
            <div class="setting-toggle">
                <span>Play sounds for posture alerts</span>
                <div id="soundToggle" class="switch"></div>
            </div>
        </div>

        <div class="setting-group">
            <label class="setting-label">Posture Sensitivity</label>
            <input type="range" id="sensitivitySlider" class="setting-input" min="1" max="10" value="5">
            <small style="color: #888;">1 = Lenient, 10 = Strict</small>
        </div>

        <div class="setting-group">
            <label class="setting-label">Theme</label>
            <select id="themeSelect" class="setting-input">
                <option value="vibrant">Vibrant (Default)</option>
                <option value="classic">Classic Dark</option>
                <option value="minimal">Minimal</option>
                <option value="sunset">Sunset</option>
            </select>
        </div>

        <div class="history-panel">
            <h3 style="color: #00d4ff; margin-bottom: 15px;">📊 Session History</h3>
            <div id="sessionHistory">
                <p style="color: #888; text-align: center; padding: 20px;">No sessions recorded yet</p>
            </div>
            <button id="exportDataBtn" style="width: 100%; margin-top: 15px;" class="setting-input">
                📥 Export Data (CSV)
            </button>
            <button id="clearHistoryBtn" style="width: 100%; margin-top: 10px; background: rgba(255,107,107,0.2); border: 1px solid rgba(255,107,107,0.3);" class="setting-input">
                🗑️ Clear History
            </button>
        </div>
    </div>

    <!-- Break Reminder Modal -->
    <div id="breakModal" class="break-modal">
        <div class="break-modal-content">
            <h3>🧘‍♀️ Time for a Break!</h3>
            <p>You've been working for <span id="workTime">30</span> minutes. Take a moment to stretch and reset your posture.</p>
            
            <div class="break-exercises">
                <div class="exercise-item">
                    <span class="emoji">🤷‍♀️</span>
                    <span class="name">Shoulder Rolls</span>
                </div>
                <div class="exercise-item">
                    <span class="emoji">💆‍♀️</span>
                    <span class="name">Neck Stretch</span>
                </div>
                <div class="exercise-item">
                    <span class="emoji">🤸‍♀️</span>
                    <span class="name">Back Arch</span>
                </div>
                <div class="exercise-item">
                    <span class="emoji">🙆‍♀️</span>
                    <span class="name">Arm Stretch</span>
                </div>
            </div>

            <div style="display: flex; gap: 15px; justify-content: center;">
                <button id="takeBreakBtn" style="background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);">
                    ✅ Take Break (2 min)
                </button>
                <button id="skipBreakBtn" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);">
                    ⏭️ Skip
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer style="background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(20px); border-top: 1px solid rgba(59, 130, 246, 0.1); padding: 40px 20px; margin-top: 60px;">
        <div style="max-width: 1200px; margin: 0 auto;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 40px; margin-bottom: 30px;">
                <div>
                    <h4 style="color: #3b82f6; margin-bottom: 15px; font-weight: 600;">FitTrack AI</h4>
                    <p style="color: #94a3b8; line-height: 1.6; margin-bottom: 15px;">AI-powered fitness tracking that respects your privacy. Get real-time feedback on your exercises and posture.</p>
                    <div style="display: flex; gap: 15px;">
                        <a href="#" style="color: #8b5cf6; font-size: 1.5em; text-decoration: none; transition: color 0.3s ease;">🐦</a>
                        <a href="#" style="color: #8b5cf6; font-size: 1.5em; text-decoration: none; transition: color 0.3s ease;">📧</a>
                        <a href="#" style="color: #8b5cf6; font-size: 1.5em; text-decoration: none; transition: color 0.3s ease;">🌐</a>
                    </div>
                </div>
                
                <div>
                    <h4 style="color: #3b82f6; margin-bottom: 15px; font-weight: 600;">Features</h4>
                    <ul style="list-style: none; padding: 0; color: #94a3b8; line-height: 1.8;">
                        <li><a href="#" onclick="switchPage('posture')" style="color: #94a3b8; text-decoration: none; transition: color 0.3s ease;">🎯 Posture Analysis</a></li>
                        <li><a href="#" onclick="switchPage('pushup')" style="color: #94a3b8; text-decoration: none; transition: color 0.3s ease;">💪 Push-up Counter</a></li>
                        <li><a href="#" onclick="switchPage('squat')" style="color: #94a3b8; text-decoration: none; transition: color 0.3s ease;">🏋️ Squat Tracking (Soon)</a></li>
                        <li><a href="#" onclick="switchPage('plank')" style="color: #94a3b8; text-decoration: none; transition: color 0.3s ease;">🤸 Plank Timer (Soon)</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 style="color: #3b82f6; margin-bottom: 15px; font-weight: 600;">Support</h4>
                    <ul style="list-style: none; padding: 0; color: #94a3b8; line-height: 1.8;">
                        <li><a href="#" onclick="switchPage('help')" style="color: #94a3b8; text-decoration: none; transition: color 0.3s ease;">❓ Help & FAQ</a></li>
                        <li><a href="#" onclick="alert('Privacy Policy coming soon!')" style="color: #94a3b8; text-decoration: none; transition: color 0.3s ease;">🔒 Privacy Policy</a></li>
                        <li><a href="#" onclick="alert('Terms of Service coming soon!')" style="color: #94a3b8; text-decoration: none; transition: color 0.3s ease;">📜 Terms of Service</a></li>
                        <li><a href="mailto:support@fittrack.ai" style="color: #94a3b8; text-decoration: none; transition: color 0.3s ease;">📧 Contact Us</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 style="color: #3b82f6; margin-bottom: 15px; font-weight: 600;">Technology</h4>
                    <ul style="list-style: none; padding: 0; color: #94a3b8; line-height: 1.8;">
                        <li>🧠 Google MediaPipe</li>
                        <li>🎥 WebRTC Camera Access</li>
                        <li>🎨 HTML5 Canvas</li>
                        <li>💾 Local Storage</li>
                        <li>🔒 Privacy-First Design</li>
                    </ul>
                </div>
            </div>
            
            <div style="border-top: 1px solid rgba(59, 130, 246, 0.1); padding-top: 20px; text-align: center;">
                <p style="color: #64748b; margin-bottom: 10px;">
                    © 2024 FitTrack AI. Built with ❤️ for your health and privacy.
                </p>
                <p style="color: #64748b; font-size: 0.9em;">
                    All processing happens locally in your browser. Your data never leaves your device.
                </p>
            </div>
        </div>
    </footer>

    <!-- Notification system -->
    <div id="notification" class="notification"></div>
    <div id="achievementBadge" class="achievement-badge">
        <h3 id="achievementTitle"></h3>
        <p id="achievementText"></p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1635988162/pose.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3.1632432234/camera_utils.js"></script>
    <!-- Vercel Analytics -->
    <script>
        // Load analytics script based on environment
        (function() {
            const isProduction = window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1';
            const scriptSrc = isProduction 
                ? 'https://va.vercel-scripts.com/v1/script.js'
                : 'https://va.vercel-scripts.com/v1/script.debug.js';
            
            const script = document.createElement('script');
            script.src = scriptSrc;
            script.setAttribute('data-collect-dnt', 'true');
            document.head.appendChild(script);
            
            console.log(`Loading Vercel Analytics: ${isProduction ? 'Production' : 'Development'} mode`);
        })();
    </script>
    
    <script>
        // Initialize Vercel Analytics
        function initAnalytics() {
            // Wait for va to be available
            if (typeof window.va !== 'undefined') {
                console.log('Vercel Analytics initialized');
                return true;
            }
            return false;
        }
        
        // Analytics tracking functions
        function trackEvent(eventName, properties = {}) {
            try {
                if (typeof window.va !== 'undefined' && typeof window.va.track === 'function') {
                    window.va.track(eventName, properties);
                    console.log('✅ Analytics tracked:', eventName, properties);
                } else {
                    console.log('📊 Analytics not ready, queued:', eventName, properties);
                    // Queue the event for when analytics loads
                    setTimeout(() => trackEvent(eventName, properties), 1000);
                }
            } catch (error) {
                console.error('Analytics error:', error);
                console.log('📊 Fallback tracking:', eventName, properties);
            }
        }
        
        // Data Storage Manager
        const StorageManager = {
            // Settings
            saveSettings(settings) {
                localStorage.setItem('postureApp_settings', JSON.stringify(settings));
            },
            
            loadSettings() {
                const saved = localStorage.getItem('postureApp_settings');
                return saved ? JSON.parse(saved) : {
                    breakReminders: true,
                    breakInterval: 30,
                    soundNotifications: true,
                    sensitivity: 5,
                    theme: 'vibrant'
                };
            },
            
            // Session History
            saveSession(sessionData) {
                const history = this.getSessionHistory();
                history.unshift({
                    id: Date.now(),
                    date: new Date().toLocaleDateString(),
                    time: new Date().toLocaleTimeString(),
                    ...sessionData
                });
                
                // Keep only last 50 sessions
                if (history.length > 50) {
                    history.splice(50);
                }
                
                localStorage.setItem('postureApp_history', JSON.stringify(history));
            },
            
            getSessionHistory() {
                const saved = localStorage.getItem('postureApp_history');
                return saved ? JSON.parse(saved) : [];
            },
            
            clearHistory() {
                localStorage.removeItem('postureApp_history');
            },
            
            // Export data as CSV
            exportData() {
                const history = this.getSessionHistory();
                if (history.length === 0) {
                    showNotification('No data to export', 'warning');
                    return;
                }
                
                const csv = [
                    ['Date', 'Time', 'Duration (min)', 'Average Score', 'Good Posture Time (min)', 'Total Readings'],
                    ...history.map(session => [
                        session.date,
                        session.time,
                        Math.round(session.duration / 60),
                        session.averageScore,
                        Math.round(session.goodPostureTime / 60),
                        session.totalReadings
                    ])
                ].map(row => row.join(',')).join('\n');
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `posture-data-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                window.URL.revokeObjectURL(url);
                
            }
        };

        // Theme Manager
        const ThemeManager = {
            themes: {
                vibrant: {
                    name: 'Vibrant',
                    primary: 'linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)',
                    secondary: 'linear-gradient(135deg, #00d4ff 0%, #5b2c87 50%, #0099cc 100%)',
                    background: 'linear-gradient(135deg, #0f0f23 0%, #1a1a3a 25%, #2d1b69 50%, #1a1a3a 75%, #0f0f23 100%)'
                },
                classic: {
                    name: 'Classic Dark',
                    primary: 'linear-gradient(135deg, #1e3c72 0%, #2a5298 100%)',
                    secondary: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    background: 'linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 100%)'
                },
                minimal: {
                    name: 'Minimal',
                    primary: 'linear-gradient(135deg, #4a5568 0%, #2d3748 100%)',
                    secondary: 'linear-gradient(135deg, #63b3ed 0%, #4299e1 100%)',
                    background: 'linear-gradient(135deg, #1a202c 0%, #2d3748 100%)'
                },
                sunset: {
                    name: 'Sunset',
                    primary: 'linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%)',
                    secondary: 'linear-gradient(135deg, #ff6b6b 0%, #feca57 100%)',
                    background: 'linear-gradient(135deg, #2c1810 0%, #5d4037 50%, #3e2723 100%)'
                }
            },
            
            apply(themeName) {
                const theme = this.themes[themeName];
                if (!theme) return;
                
                document.documentElement.style.setProperty('--theme-primary', theme.primary);
                document.documentElement.style.setProperty('--theme-secondary', theme.secondary);
                document.body.style.background = theme.background;
                
                // Update header
                const header = document.querySelector('.app-header');
                if (header) header.style.background = theme.primary;
            }
        };

        // Break Reminder Manager
        const BreakManager = {
            breakTimer: null,
            breakStartTime: null,
            isOnBreak: false,
            
            start(intervalMinutes) {
                this.stop(); // Clear existing timer
                this.breakTimer = setInterval(() => {
                    this.showBreakReminder();
                }, intervalMinutes * 60 * 1000);
            },
            
            stop() {
                if (this.breakTimer) {
                    clearInterval(this.breakTimer);
                    this.breakTimer = null;
                }
            },
            
            showBreakReminder() {
                const modal = document.getElementById('breakModal');
                const workTime = document.getElementById('workTime');
                const interval = settings.breakInterval;
                
                workTime.textContent = interval;
                modal.classList.add('show');
                
                // Play notification sound if enabled
                if (settings.soundNotifications) {
                    this.playNotificationSound();
                }
                
                trackEvent('break_reminder_shown', {
                    interval_minutes: interval,
                    timestamp: new Date().toISOString()
                });
            },
            
            takeBreak() {
                const modal = document.getElementById('breakModal');
                modal.classList.remove('show');
                this.isOnBreak = true;
                this.breakStartTime = Date.now();
                
                
                // Auto-end break after 2 minutes
                setTimeout(() => {
                    this.endBreak();
                }, 2 * 60 * 1000);
                
                trackEvent('break_taken', {
                    timestamp: new Date().toISOString()
                });
            },
            
            skipBreak() {
                const modal = document.getElementById('breakModal');
                modal.classList.remove('show');
                
                trackEvent('break_skipped', {
                    timestamp: new Date().toISOString()
                });
            },
            
            endBreak() {
                if (this.isOnBreak) {
                    this.isOnBreak = false;
                    const breakDuration = Date.now() - this.breakStartTime;
                    
                    trackEvent('break_ended', {
                        duration_seconds: Math.round(breakDuration / 1000),
                        timestamp: new Date().toISOString()
                    });
                }
            },
            
            playNotificationSound() {
                // Create a simple beep sound
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            }
        };

        // Settings Manager
        let settings = StorageManager.loadSettings();

        // DOM Elements
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const calibrateBtn = document.getElementById('calibrateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const statusMessage = document.getElementById('statusMessage');
        const realtimeFeedback = document.getElementById('realtimeFeedback');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const notification = document.getElementById('notification');
        const achievementBadge = document.getElementById('achievementBadge');
        
        // New DOM Elements
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsPanel = document.getElementById('settingsPanel');
        const breakReminderToggle = document.getElementById('breakReminderToggle');
        const breakInterval = document.getElementById('breakInterval');
        const soundToggle = document.getElementById('soundToggle');
        const sensitivitySlider = document.getElementById('sensitivitySlider');
        const themeSelect = document.getElementById('themeSelect');
        const sessionHistory = document.getElementById('sessionHistory');
        const exportDataBtn = document.getElementById('exportDataBtn');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        const takeBreakBtn = document.getElementById('takeBreakBtn');
        const skipBreakBtn = document.getElementById('skipBreakBtn');
        
        // Navigation Elements
        const navButtons = {
            posture: document.getElementById('postureNavBtn'),
            pushup: document.getElementById('pushupNavBtn'),
            squat: document.getElementById('squatNavBtn'),
            plank: document.getElementById('plankNavBtn'),
            about: document.getElementById('aboutNavBtn'),
            help: document.getElementById('helpNavBtn'),
            signup: document.getElementById('signupNavBtn')
        };
        
        const pages = {
            posture: document.getElementById('posturePage'),
            pushup: document.getElementById('pushupPage'),
            squat: document.getElementById('squatPage'),
            plank: document.getElementById('plankPage'),
            about: document.getElementById('aboutPage'),
            help: document.getElementById('helpPage'),
            signup: document.getElementById('signupPage')
        };
        
        // Push-up Elements
        const pushupVideo = document.getElementById('pushupVideo');
        const pushupCanvas = document.getElementById('pushupCanvas');
        
        // Squat Elements
        const squatVideo = document.getElementById('squatVideo');
        const squatCanvas = document.getElementById('squatCanvas');
        const squatCounter = document.getElementById('squatCounter');
        const squatStatus = document.getElementById('squatStatus');
        const startSquatBtn = document.getElementById('startSquatBtn');
        const resetSquatBtn = document.getElementById('resetSquatBtn');
        const stopSquatBtn = document.getElementById('stopSquatBtn');
        const squatFeedback = document.getElementById('squatFeedback');
        
        // Plank Elements
        const plankVideo = document.getElementById('plankVideo');
        const plankCanvas = document.getElementById('plankCanvas');
        const plankTimer = document.getElementById('plankTimer');
        const plankStatus = document.getElementById('plankStatus');
        const startPlankBtn = document.getElementById('startPlankBtn');
        const resetPlankBtn = document.getElementById('resetPlankBtn');
        const stopPlankBtn = document.getElementById('stopPlankBtn');
        const plankFeedback = document.getElementById('plankFeedback');
        
        // Canvas contexts
        const squatCtx = squatCanvas.getContext('2d');
        const plankCtx = plankCanvas.getContext('2d');
        const pushupCtx = pushupCanvas.getContext('2d');
        const startPushupBtn = document.getElementById('startPushupBtn');
        const stopPushupBtn = document.getElementById('stopPushupBtn');
        const resetPushupBtn = document.getElementById('resetPushupBtn');
        const pushupCounter = document.getElementById('pushupCounter');
        const pushupStatus = document.getElementById('pushupStatus');
        const pushupFeedback = document.getElementById('pushupFeedback');
        const pushupStatusMessage = document.getElementById('pushupStatusMessage');
        
        // State variables
        let camera = null;
        let pose = null;
        let calibratedData = null;
        let scoreHistory = [];
        let sessionStats = {
            startTime: null,
            totalScore: 0,
            scoreCount: 0,
            goodPostureTime: 0,
            lastUpdateTime: null
        };
        
        // Advanced posture tracking
        let postureBuffer = [];
        const BUFFER_SIZE = 10;
        
        // Achievement tracking
        let achievements = {
            firstGoodPosture: false,
            fiveMinutesGood: false,
            perfectScore: false,
            fiftyReadings: false,
            calibratedUser: false
        };
        
        // Push-up tracking
        let pushupCamera = null;
        let pushupPose = null;
        let pushupCount = 0;
        let pushupState = 'ready'; // 'ready', 'up', 'down', 'transitioning'
        let lastPushupPosition = null;
        let pushupStats = {
            currentSet: 0,
            bestSet: 0,
            totalToday: 0,
            formQuality: 0,
            personalBest: 0,
            weeklyTotal: 0
        };
        
        // Squat tracking
        let squatCamera = null;
        let squatPose = null;
        let squatCount = 0;
        let squatState = 'ready'; // 'ready', 'up', 'down', 'transitioning'
        let lastSquatPosition = null;
        let squatStats = {
            currentSet: 0,
            bestSet: 0,
            totalToday: 0,
            formScore: 100,
            depthQuality: 0
        };
        
        // Plank tracking  
        let plankCamera = null;
        let plankPose = null;
        let plankStartTime = null;
        let plankCurrentTime = 0;
        let plankIsActive = false;
        let plankStats = {
            bestTime: 0,
            totalTime: 0,
            currentSession: 0,
            formScore: 100,
            stabilityScore: 100
        };
        
        // Navigation state
        let currentPage = 'posture';
        
        // Initialize MediaPipe Pose with optimized settings
        function initPose() {
            pose = new Pose({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1635988162/${file}`;
                }
            });
            
            pose.setOptions({
                modelComplexity: 2, // Higher accuracy
                smoothLandmarks: true,
                enableSegmentation: false,
                minDetectionConfidence: 0.6,
                minTrackingConfidence: 0.6
            });
            
            pose.onResults(onResults);
        }
        
        // Enhanced posture analysis
        function analyzePosture(landmarks) {
            // Critical points for posture
            const nose = landmarks[0];
            const leftEye = landmarks[2];
            const rightEye = landmarks[5];
            const leftEar = landmarks[7];
            const rightEar = landmarks[8];
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const leftElbow = landmarks[13];
            const rightElbow = landmarks[14];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            
            // Calculate key metrics
            const metrics = {};
            
            // 1. Spine alignment (vertical deviation)
            const shoulderCenter = {
                x: (leftShoulder.x + rightShoulder.x) / 2,
                y: (leftShoulder.y + rightShoulder.y) / 2,
                z: (leftShoulder.z + rightShoulder.z) / 2
            };
            
            const hipCenter = {
                x: (leftHip.x + rightHip.x) / 2,
                y: (leftHip.y + rightHip.y) / 2,
                z: (leftHip.z + rightHip.z) / 2
            };
            
            const spineVector = {
                x: shoulderCenter.x - hipCenter.x,
                y: shoulderCenter.y - hipCenter.y
            };
            
            metrics.spineAngle = Math.abs(Math.atan2(spineVector.x, Math.abs(spineVector.y)) * 180 / Math.PI);
            
            // 2. Shoulder levelness
            const shoulderHeightDiff = Math.abs(leftShoulder.y - rightShoulder.y);
            const shoulderWidth = Math.abs(leftShoulder.x - rightShoulder.x);
            metrics.shoulderTilt = (shoulderHeightDiff / shoulderWidth) * 100;
            
            // 3. Head forward position (using ear-shoulder alignment)
            const earCenter = {
                x: (leftEar.x + rightEar.x) / 2,
                y: (leftEar.y + rightEar.y) / 2
            };
            
            const headForwardDistance = Math.abs(earCenter.x - shoulderCenter.x);
            metrics.headForwardAngle = Math.atan2(headForwardDistance, Math.abs(earCenter.y - shoulderCenter.y)) * 180 / Math.PI;
            
            // 4. Shoulder roll (using z-coordinates)
            metrics.shoulderRoll = Math.abs(leftShoulder.z - rightShoulder.z) * 100;
            
            // 5. Upper body symmetry
            const leftArmAngle = calculateAngle(leftShoulder, leftElbow, leftHip);
            const rightArmAngle = calculateAngle(rightShoulder, rightElbow, rightHip);
            metrics.armSymmetry = Math.abs(leftArmAngle - rightArmAngle);
            
            // Calculate comprehensive score
            let score = 100;
            
            // Spine alignment (most important)
            if (metrics.spineAngle > 3) {
                score -= Math.min(metrics.spineAngle * 2.5, 35);
            }
            
            // Shoulder levelness
            if (metrics.shoulderTilt > 3) {
                score -= Math.min(metrics.shoulderTilt * 2, 20);
            }
            
            // Head forward position
            if (metrics.headForwardAngle > 15) {
                score -= Math.min((metrics.headForwardAngle - 15) * 1.5, 25);
            }
            
            // Shoulder roll
            if (metrics.shoulderRoll > 5) {
                score -= Math.min(metrics.shoulderRoll, 10);
            }
            
            // Arm symmetry
            if (metrics.armSymmetry > 20) {
                score -= Math.min(metrics.armSymmetry / 4, 10);
            }
            
            // Apply calibration if available
            if (calibratedData) {
                const calibrationScore = compareToCalibration(landmarks, calibratedData);
                score = (score * 0.4 + calibrationScore * 0.6); // Weighted average
            }
            
            metrics.score = Math.max(0, Math.round(score));
            metrics.confidence = landmarks[0].visibility > 0.8 ? 'High' : 'Medium';
            
            return metrics;
        }
        
        // Calculate angle between three points
        function calculateAngle(p1, p2, p3) {
            const v1 = { x: p1.x - p2.x, y: p1.y - p2.y };
            const v2 = { x: p3.x - p2.x, y: p3.y - p2.y };
            const dot = v1.x * v2.x + v1.y * v2.y;
            const det = v1.x * v2.y - v1.y * v2.x;
            return Math.abs(Math.atan2(det, dot) * 180 / Math.PI);
        }
        
        // Compare current posture to calibrated reference
        function compareToCalibration(current, reference) {
            const keyPoints = [0, 7, 8, 11, 12, 13, 14, 23, 24];
            let totalDeviation = 0;
            
            for (let i of keyPoints) {
                const dx = current[i].x - reference[i].x;
                const dy = current[i].y - reference[i].y;
                const dz = current[i].z - reference[i].z;
                totalDeviation += Math.sqrt(dx*dx + dy*dy + dz*dz);
            }
            
            const normalizedDeviation = totalDeviation / keyPoints.length;
            return Math.max(0, 100 - normalizedDeviation * 500);
        }
        
        // Smooth metrics using moving average
        function smoothMetrics(metrics) {
            postureBuffer.push(metrics);
            if (postureBuffer.length > BUFFER_SIZE) {
                postureBuffer.shift();
            }
            
            const smoothed = {};
            const keys = Object.keys(metrics);
            
            keys.forEach(key => {
                if (typeof metrics[key] === 'number') {
                    const values = postureBuffer.map(m => m[key]);
                    smoothed[key] = values.reduce((a, b) => a + b, 0) / values.length;
                } else {
                    smoothed[key] = metrics[key];
                }
            });
            
            return smoothed;
        }
        
        // Process pose detection results
        function onResults(results) {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (results.poseLandmarks) {
                const metrics = analyzePosture(results.poseLandmarks);
                const smoothedMetrics = smoothMetrics(metrics);
                
                drawEnhancedSkeleton(results.poseLandmarks, smoothedMetrics.score);
                updateUI(smoothedMetrics);
                updateSessionStats(smoothedMetrics);
                updateScoreHistory(smoothedMetrics.score);
                provideFeedback(smoothedMetrics);
                checkAchievements(smoothedMetrics);
                
                showStatus('', 'success');
            } else {
                showStatus('Adjust your position - full upper body should be visible', 'alert');
            }
        }
        
        // Enhanced skeleton visualization
        function drawEnhancedSkeleton(landmarks, score) {
            // Determine color based on score
            let primaryColor, glowColor;
            if (score >= 80) {
                primaryColor = '#00ff88';
                glowColor = 'rgba(0, 255, 136, 0.3)';
            } else if (score >= 60) {
                primaryColor = '#ffcc00';
                glowColor = 'rgba(255, 204, 0, 0.3)';
            } else {
                primaryColor = '#ff4444';
                glowColor = 'rgba(255, 68, 68, 0.3)';
            }
            
            // Add glow effect
            ctx.shadowColor = glowColor;
            ctx.shadowBlur = 10;
            
            // Draw connections with varying thickness
            const connections = [
                // Head
                { points: [0, 7], width: 2 },
                { points: [7, 8], width: 2 },
                { points: [8, 0], width: 2 },
                // Torso
                { points: [11, 12], width: 4 }, // Shoulders
                { points: [11, 23], width: 3 }, // Left side
                { points: [12, 24], width: 3 }, // Right side
                { points: [23, 24], width: 4 }, // Hips
                // Arms
                { points: [11, 13], width: 2 },
                { points: [13, 15], width: 2 },
                { points: [12, 14], width: 2 },
                { points: [14, 16], width: 2 },
            ];
            
            connections.forEach(conn => {
                const [start, end] = conn.points;
                if (landmarks[start] && landmarks[end]) {
                    ctx.strokeStyle = primaryColor;
                    ctx.lineWidth = conn.width;
                    ctx.lineCap = 'round';
                    ctx.beginPath();
                    ctx.moveTo(landmarks[start].x * canvas.width, landmarks[start].y * canvas.height);
                    ctx.lineTo(landmarks[end].x * canvas.width, landmarks[end].y * canvas.height);
                    ctx.stroke();
                }
            });
            
            // Draw spine with gradient
            const shoulderMid = {
                x: (landmarks[11].x + landmarks[12].x) / 2,
                y: (landmarks[11].y + landmarks[12].y) / 2
            };
            const hipMid = {
                x: (landmarks[23].x + landmarks[24].x) / 2,
                y: (landmarks[23].y + landmarks[24].y) / 2
            };
            
            const gradient = ctx.createLinearGradient(
                shoulderMid.x * canvas.width, shoulderMid.y * canvas.height,
                hipMid.x * canvas.width, hipMid.y * canvas.height
            );
            gradient.addColorStop(0, primaryColor);
            gradient.addColorStop(1, primaryColor + '88');
            
            ctx.strokeStyle = gradient;
            ctx.lineWidth = 6;
            ctx.beginPath();
            ctx.moveTo(shoulderMid.x * canvas.width, shoulderMid.y * canvas.height);
            ctx.lineTo(hipMid.x * canvas.width, hipMid.y * canvas.height);
            ctx.stroke();
            
            // Draw key points
            ctx.shadowBlur = 5;
            const keyPoints = [0, 7, 8, 11, 12, 13, 14, 15, 16, 23, 24];
            keyPoints.forEach(i => {
                ctx.fillStyle = primaryColor;
                ctx.beginPath();
                ctx.arc(
                    landmarks[i].x * canvas.width, 
                    landmarks[i].y * canvas.height, 
                    landmarks[i].visibility > 0.8 ? 6 : 4, 
                    0, 
                    2 * Math.PI
                );
                ctx.fill();
            });
            
            ctx.shadowBlur = 0;
        }
        
        // Update UI elements
        function updateUI(metrics) {
            // Main score
            const scoreElement = document.getElementById('mainScore');
            scoreElement.textContent = metrics.score + '%';
            scoreElement.className = 'score-value';
            if (metrics.score >= 80) {
                scoreElement.classList.add('good');
                document.getElementById('scoreLabel').textContent = 'Excellent Posture';
            } else if (metrics.score >= 60) {
                scoreElement.classList.add('fair');
                document.getElementById('scoreLabel').textContent = 'Fair Posture';
            } else {
                scoreElement.classList.add('poor');
                document.getElementById('scoreLabel').textContent = 'Needs Improvement';
            }
            
            // Individual metrics
            document.getElementById('spineAngle').textContent = metrics.spineAngle.toFixed(1) + '°';
            document.getElementById('spineBar').style.width = Math.max(0, 100 - metrics.spineAngle * 3) + '%';
            
            const shoulderStatus = metrics.shoulderTilt < 3 ? 'Balanced' : 
                                   metrics.shoulderTilt < 6 ? 'Slightly Uneven' : 'Uneven';
            document.getElementById('shoulderBalance').textContent = shoulderStatus;
            document.getElementById('shoulderBar').style.width = Math.max(0, 100 - metrics.shoulderTilt * 10) + '%';
            
            document.getElementById('headAngle').textContent = metrics.headForwardAngle.toFixed(1) + '°';
            document.getElementById('headBar').style.width = Math.max(0, 100 - metrics.headForwardAngle * 2) + '%';
            
            document.getElementById('confidence').textContent = metrics.confidence;
        }
        
        // Update session statistics
        function updateSessionStats(metrics) {
            const now = Date.now();
            
            if (!sessionStats.startTime) {
                sessionStats.startTime = now;
                sessionStats.lastUpdateTime = now;
            }
            
            sessionStats.totalScore += metrics.score;
            sessionStats.scoreCount++;
            
            if (metrics.score >= 80) {
                sessionStats.goodPostureTime += (now - sessionStats.lastUpdateTime) / 1000;
            }
            
            sessionStats.lastUpdateTime = now;
            
            // Update displays
            const avgScore = Math.round(sessionStats.totalScore / sessionStats.scoreCount);
            document.getElementById('avgScore').textContent = avgScore + '%';
            
            const goodTime = Math.round(sessionStats.goodPostureTime);
            const minutes = Math.floor(goodTime / 60);
            const seconds = goodTime % 60;
            document.getElementById('goodPostureTime').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            const totalTime = Math.round((now - sessionStats.startTime) / 1000);
            const totalMinutes = Math.floor(totalTime / 60);
            const totalSeconds = totalTime % 60;
            document.getElementById('sessionTime').textContent = 
                `${totalMinutes.toString().padStart(2, '0')}:${totalSeconds.toString().padStart(2, '0')}`;
        }
        
        // Update score history chart
        function updateScoreHistory(score) {
            scoreHistory.push(score);
            if (scoreHistory.length > 50) {
                scoreHistory.shift();
            }
            
            // Track posture milestones
            if (scoreHistory.length % 20 === 0) {
                const recentAvg = scoreHistory.slice(-10).reduce((a, b) => a + b, 0) / 10;
                trackEvent('posture_milestone', {
                    readings_count: scoreHistory.length,
                    recent_average_score: Math.round(recentAvg),
                    current_score: score,
                    timestamp: new Date().toISOString()
                });
            }
            
            if (scoreHistory.length > 1) {
                const width = 300;
                const height = 100;
                const step = width / (scoreHistory.length - 1);
                
                let pathData = '';
                let lineData = '';
                
                scoreHistory.forEach((value, index) => {
                    const x = index * step;
                    const y = height - (value / 100 * height);
                    
                    if (index === 0) {
                        pathData = `M ${x} ${y}`;
                        lineData = `M ${x} ${y}`;
                    } else {
                        pathData += ` L ${x} ${y}`;
                        lineData += ` L ${x} ${y}`;
                    }
                });
                
                pathData += ` L ${width} ${height} L 0 ${height} Z`;
                
                document.getElementById('chartPath').setAttribute('d', pathData);
                document.getElementById('chartLine').setAttribute('d', lineData);
            }
        }
        
        // Provide real-time feedback
        function provideFeedback(metrics) {
            const feedback = [];
            
            if (metrics.spineAngle > 10) {
                feedback.push('⚠️ Straighten your spine');
            }
            if (metrics.shoulderTilt > 5) {
                feedback.push('⚠️ Level your shoulders');
            }
            if (metrics.headForwardAngle > 20) {
                feedback.push('⚠️ Pull your head back');
            }
            
            if (feedback.length > 0) {
                realtimeFeedback.innerHTML = feedback.join('<br>');
                realtimeFeedback.style.display = 'block';
            } else if (metrics.score >= 80) {
                realtimeFeedback.innerHTML = '✅ Great posture!';
                realtimeFeedback.style.display = 'block';
            } else {
                realtimeFeedback.style.display = 'none';
            }
            
            // Update dynamic tips based on current posture
            updateDynamicTips(metrics);
        }
        
        // Update tips based on current posture issues
        function updateDynamicTips(metrics) {
            const tipsContainer = document.getElementById('dynamicTips');
            const tips = [];
            
            if (metrics.spineAngle > 10) {
                tips.push({
                    icon: '📏',
                    text: 'Imagine a string pulling you up from the top of your head'
                });
            }
            
            if (metrics.shoulderTilt > 5) {
                tips.push({
                    icon: '⚖️',
                    text: 'Check if your computer screen is centered - uneven shoulders often come from looking to one side'
                });
            }
            
            if (metrics.headForwardAngle > 20) {
                tips.push({
                    icon: '👂',
                    text: 'Your ears should align vertically with your shoulders'
                });
            }
            
            if (metrics.score >= 80) {
                tips.push({
                    icon: '🌟',
                    text: 'Excellent! Maintain this position and take breaks every 30 minutes'
                });
                tips.push({
                    icon: '💪',
                    text: 'Consider doing shoulder rolls and neck stretches periodically'
                });
            }
            
            if (tips.length === 0) {
                tips.push({
                    icon: '✓',
                    text: 'Keep your feet flat on the floor, hip-width apart'
                });
                tips.push({
                    icon: '✓',
                    text: 'Your screen should be at eye level to prevent neck strain'
                });
            }
            
            tipsContainer.innerHTML = tips.map(tip => `
                <div class="tip-item">
                    <span class="tip-icon">${tip.icon}</span>
                    <span>${tip.text}</span>
                </div>
            `).join('');
        }
        
        // Show status messages
        function showStatus(message, type = 'alert') {
            if (!message) {
                statusMessage.innerHTML = '';
                return;
            }
            
            let className = 'alert-box';
            if (type === 'error') className += ' error';
            if (type === 'success') className += ' success';
            
            statusMessage.innerHTML = `<div class="${className}">${message}</div>`;
        }
        
        // Show notification
        function showNotification(message, type = 'info', duration = 4000) {
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }
        
        // Show achievement
        function showAchievement(title, text) {
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementText').textContent = text;
            achievementBadge.classList.add('show');
            
            setTimeout(() => {
                achievementBadge.classList.remove('show');
            }, 3000);
            
            trackEvent('achievement_unlocked', {
                achievement_title: title,
                timestamp: new Date().toISOString()
            });
        }
        
        // Check for achievements
        function checkAchievements(metrics) {
            // First good posture
            if (!achievements.firstGoodPosture && metrics.score >= 80) {
                achievements.firstGoodPosture = true;
                showAchievement('🎉 Great Start!', 'You achieved excellent posture for the first time!');
            }
            
            // Perfect score
            if (!achievements.perfectScore && metrics.score >= 95) {
                achievements.perfectScore = true;
                showAchievement('⭐ Perfect Posture!', 'You achieved a 95+ posture score!');
            }
            
            // 50 readings milestone
            if (!achievements.fiftyReadings && scoreHistory.length >= 50) {
                achievements.fiftyReadings = true;
                showAchievement('📊 Data Collector!', 'You\'ve completed 50 posture readings!');
            }
            
            // 5 minutes of good posture
            if (!achievements.fiveMinutesGood && sessionStats.goodPostureTime >= 300) {
                achievements.fiveMinutesGood = true;
                showAchievement('⏰ Consistency Master!', 'You maintained good posture for 5 minutes!');
            }
        }
        
        // Toggle fullscreen
        function toggleFullscreen() {
            const videoWrapper = document.querySelector('.video-wrapper');
            if (!document.fullscreenElement) {
                videoWrapper.requestFullscreen().catch(err => {
                    showNotification('Fullscreen not supported', 'warning');
                });
            } else {
                document.exitFullscreen();
            }
        }
        
        // Start camera
        async function startCamera() {
            try {
                showStatus('Initializing camera and AI model...', 'alert');
                
                // Track session start
                trackEvent('session_started', {
                    timestamp: new Date().toISOString(),
                    device: navigator.userAgent
                });
                
                if (!pose) {
                    initPose();
                }
                
                camera = new Camera(video, {
                    onFrame: async () => {
                        if (pose) {
                            await pose.send({image: video});
                        }
                    },
                    width: 1280,
                    height: 720,
                    facingMode: 'user'
                });
                
                await camera.start();
                
                startBtn.disabled = true;
                stopBtn.disabled = false;
                calibrateBtn.disabled = false;
                resetBtn.disabled = false;
                
                showStatus('✅ Camera active - Position yourself in frame', 'success');
                setTimeout(() => showStatus(''), 3000);
                
                // Reset session stats
                sessionStats = {
                    startTime: Date.now(),
                    totalScore: 0,
                    scoreCount: 0,
                    goodPostureTime: 0,
                    lastUpdateTime: Date.now()
                };
                
                // Start break reminders if enabled
                if (settings.breakReminders) {
                    BreakManager.start(settings.breakInterval);
                }
                
                // Track successful camera initialization
                trackEvent('camera_initialized', {
                    timestamp: new Date().toISOString()
                });
                
                
            } catch (error) {
                console.error('Camera error:', error);
                showStatus('❌ Failed to start camera. Please ensure camera permissions are granted.', 'error');
                
                // Track camera error
                trackEvent('camera_error', {
                    error: error.message,
                    timestamp: new Date().toISOString()
                });
            }
        }
        
        // Stop camera
        function stopCamera() {
            // Save session data before stopping
            if (sessionStats.startTime) {
                const sessionDuration = (Date.now() - sessionStats.startTime) / 1000;
                const avgScore = sessionStats.scoreCount > 0 ? Math.round(sessionStats.totalScore / sessionStats.scoreCount) : 0;
                
                // Save session to history
                StorageManager.saveSession({
                    duration: sessionDuration,
                    averageScore: avgScore,
                    goodPostureTime: sessionStats.goodPostureTime,
                    totalReadings: sessionStats.scoreCount
                });
                
                // Update history display
                updateSessionHistoryDisplay();
                
                trackEvent('session_ended', {
                    duration_seconds: Math.round(sessionDuration),
                    average_score: avgScore,
                    good_posture_time: Math.round(sessionStats.goodPostureTime),
                    total_readings: sessionStats.scoreCount,
                    timestamp: new Date().toISOString()
                });
            }
            
            // Stop break reminders
            BreakManager.stop();
            
            if (camera) {
                camera.stop();
                camera = null;
            }
            
            if (pose) {
                pose.close();
                pose = null;
            }
            
            if (video.srcObject) {
                video.srcObject.getTracks().forEach(track => track.stop());
                video.srcObject = null;
            }
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            startBtn.disabled = false;
            stopBtn.disabled = true;
            calibrateBtn.disabled = true;
            resetBtn.disabled = true;
            
            // Reset displays
            document.getElementById('mainScore').textContent = '--';
            document.getElementById('scoreLabel').textContent = 'Posture Score';
            document.getElementById('spineAngle').textContent = '--°';
            document.getElementById('shoulderBalance').textContent = '--';
            document.getElementById('headAngle').textContent = '--°';
            document.getElementById('confidence').textContent = '--';
            
            // Reset bars
            document.getElementById('spineBar').style.width = '0%';
            document.getElementById('shoulderBar').style.width = '0%';
            document.getElementById('headBar').style.width = '0%';
            
            realtimeFeedback.style.display = 'none';
            
            showStatus('Camera stopped', 'alert');
            
            // Clear history
            scoreHistory = [];
            postureBuffer = [];
        }
        
        // Calibrate good posture
        function calibratePosture() {
            if (!pose) return;
            
            // Track calibration start
            trackEvent('calibration_started', {
                timestamp: new Date().toISOString()
            });
            
            showStatus('📸 Hold your best posture for 3 seconds...', 'alert');
            
            let countdown = 3;
            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    showStatus(`📸 Calibrating in ${countdown}...`, 'alert');
                } else {
                    clearInterval(countdownInterval);
                    
                    // Capture current frame
                    pose.onResults((results) => {
                        if (results.poseLandmarks) {
                            calibratedData = JSON.parse(JSON.stringify(results.poseLandmarks));
                            
                            showStatus('✅ Posture calibrated! The system will now track deviations from this position.', 'success');
                            
                            // Store calibration metrics
                            const calibrationMetrics = analyzePosture(calibratedData);
                            console.log('Calibration metrics:', calibrationMetrics);
                            
                            // Track successful calibration
                            trackEvent('calibration_completed', {
                                baseline_score: calibrationMetrics.score,
                                spine_angle: calibrationMetrics.spineAngle,
                                shoulder_tilt: calibrationMetrics.shoulderTilt,
                                head_forward_angle: calibrationMetrics.headForwardAngle,
                                timestamp: new Date().toISOString()
                            });
                            
                            // Achievement for calibrating
                            if (!achievements.calibratedUser) {
                                achievements.calibratedUser = true;
                                showAchievement('🎯 Setup Complete!', 'You calibrated your personal posture baseline!');
                            }
                            
                            // Restore normal processing
                            setTimeout(() => {
                                pose.onResults(onResults);
                                showStatus('');
                            }, 3000);
                        }
                    });
                }
            }, 1000);
        }
        
        // Reset calibration
        function resetCalibration() {
            // Track calibration reset
            trackEvent('calibration_reset', {
                timestamp: new Date().toISOString()
            });
            
            calibratedData = null;
            postureBuffer = [];
            showStatus('Calibration reset - Using default posture standards', 'alert');
            setTimeout(() => showStatus(''), 3000);
        }
        
        // Settings utility functions
        function updateSettingsUI() {
            breakReminderToggle.classList.toggle('active', settings.breakReminders);
            breakInterval.value = settings.breakInterval;
            soundToggle.classList.toggle('active', settings.soundNotifications);
            sensitivitySlider.value = settings.sensitivity;
            themeSelect.value = settings.theme;
            
            // Apply theme
            ThemeManager.apply(settings.theme);
        }

        function saveSettings() {
            StorageManager.saveSettings(settings);
            
            // Restart break reminders if camera is active
            if (camera && settings.breakReminders) {
                BreakManager.start(settings.breakInterval);
            } else if (camera) {
                BreakManager.stop();
            }
        }

        function updateSessionHistoryDisplay() {
            const history = StorageManager.getSessionHistory();
            
            if (history.length === 0) {
                sessionHistory.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">No sessions recorded yet</p>';
                return;
            }
            
            sessionHistory.innerHTML = history.slice(0, 10).map(session => `
                <div class="history-item">
                    <div>
                        <div class="history-date">${session.date} ${session.time}</div>
                        <div style="font-size: 0.8em; color: #aaa;">
                            ${Math.round(session.duration / 60)}min session
                        </div>
                    </div>
                    <div class="history-score ${session.averageScore >= 80 ? 'good' : session.averageScore >= 60 ? 'fair' : 'poor'}">
                        ${session.averageScore}%
                    </div>
                </div>
            `).join('');
        }

        // Event listeners
        startBtn.addEventListener('click', startCamera);
        stopBtn.addEventListener('click', stopCamera);
        calibrateBtn.addEventListener('click', calibratePosture);
        resetBtn.addEventListener('click', resetCalibration);
        fullscreenBtn.addEventListener('click', toggleFullscreen);
        
        // Settings event listeners
        settingsBtn.addEventListener('click', () => {
            settingsPanel.classList.toggle('open');
        });
        
        // Close settings when clicking outside
        document.addEventListener('click', (e) => {
            if (!settingsPanel.contains(e.target) && !settingsBtn.contains(e.target)) {
                settingsPanel.classList.remove('open');
            }
        });
        
        breakReminderToggle.addEventListener('click', () => {
            settings.breakReminders = !settings.breakReminders;
            breakReminderToggle.classList.toggle('active', settings.breakReminders);
            saveSettings();
        });
        
        breakInterval.addEventListener('change', () => {
            settings.breakInterval = parseInt(breakInterval.value);
            saveSettings();
        });
        
        soundToggle.addEventListener('click', () => {
            settings.soundNotifications = !settings.soundNotifications;
            soundToggle.classList.toggle('active', settings.soundNotifications);
            saveSettings();
        });
        
        sensitivitySlider.addEventListener('input', () => {
            settings.sensitivity = parseInt(sensitivitySlider.value);
            saveSettings();
        });
        
        themeSelect.addEventListener('change', () => {
            settings.theme = themeSelect.value;
            ThemeManager.apply(settings.theme);
            saveSettings();
        });
        
        exportDataBtn.addEventListener('click', () => {
            StorageManager.exportData();
        });
        
        clearHistoryBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to clear all session history? This cannot be undone.')) {
                StorageManager.clearHistory();
                updateSessionHistoryDisplay();
            }
        });
        
        // Break modal event listeners
        takeBreakBtn.addEventListener('click', () => {
            BreakManager.takeBreak();
        });
        
        skipBreakBtn.addEventListener('click', () => {
            BreakManager.skipBreak();
        });
        
        // Navigation Management
        function switchPage(pageName) {
            // Stop any running cameras first - be more aggressive about cleanup
            try {
                if (camera) stopCamera();
            } catch (e) {
                console.warn('Error stopping main camera:', e);
            }
            
            try {
                if (pushupCamera) stopPushupCamera();
            } catch (e) {
                console.warn('Error stopping pushup camera:', e);
            }
            
            try {
                if (squatCamera) stopSquatCamera();
            } catch (e) {
                console.warn('Error stopping squat camera:', e);
            }
            
            try {
                if (plankCamera) stopPlankCamera();
            } catch (e) {
                console.warn('Error stopping plank camera:', e);
            }
            
            // Additional cleanup - force stop all video streams
            [video, pushupVideo, squatVideo, plankVideo].forEach(videoElement => {
                if (videoElement && videoElement.srcObject) {
                    try {
                        videoElement.srcObject.getTracks().forEach(track => track.stop());
                        videoElement.srcObject = null;
                    } catch (e) {
                        console.warn('Error stopping video stream:', e);
                    }
                }
            });
            
            // Update navigation
            Object.keys(navButtons).forEach(key => {
                navButtons[key].classList.remove('active');
                pages[key].classList.remove('active');
            });
            
            navButtons[pageName].classList.add('active');
            pages[pageName].classList.add('active');
            currentPage = pageName;
            
            // Update page title
            const titles = {
                posture: { title: '🎯 Advanced Posture Analyzer', subtitle: 'AI-powered real-time posture detection and spine alignment monitoring' },
                pushup: { title: '💪 Push-up Counter', subtitle: 'AI-powered push-up form analysis and counting' },
                squat: { title: '🏋️ Squat Counter', subtitle: 'AI-powered squat form analysis and counting' },
                plank: { title: '🤸 Plank Timer', subtitle: 'AI-powered plank form monitoring and timing' },
                about: { title: 'ℹ️ About FitTrack AI', subtitle: 'Learn about our AI-powered fitness platform' },
                help: { title: '❓ Help & Support', subtitle: 'Get help and find answers to common questions' },
                signup: { title: '👤 Join Our Community', subtitle: 'Create your account and start your fitness journey' }
            };
            
            const pageTitle = document.getElementById('pageTitle');
            pageTitle.innerHTML = `
                <h1>${titles[pageName].title}</h1>
                <p>${titles[pageName].subtitle}</p>
            `;
        }

        // Navigation event listeners
        Object.keys(navButtons).forEach(key => {
            navButtons[key].addEventListener('click', () => {
                switchPage(key);
            });
        });

        // Push-up Functions
        function initPushupPose() {
            pushupPose = new Pose({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1635988162/${file}`;
                }
            });
            
            pushupPose.setOptions({
                modelComplexity: 1,
                smoothLandmarks: true,
                enableSegmentation: false,
                minDetectionConfidence: 0.5,
                minTrackingConfidence: 0.5
            });
            
            pushupPose.onResults(onPushupResults);
        }

        function analyzePushup(landmarks) {
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const leftElbow = landmarks[13];
            const rightElbow = landmarks[14];
            const leftWrist = landmarks[15];
            const rightWrist = landmarks[16];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            
            // Calculate average positions
            const shoulderY = (leftShoulder.y + rightShoulder.y) / 2;
            const elbowY = (leftElbow.y + rightElbow.y) / 2;
            const wristY = (leftWrist.y + rightWrist.y) / 2;
            const hipY = (leftHip.y + rightHip.y) / 2;
            
            // Determine push-up position based on arm angle
            const armAngle = Math.atan2(elbowY - shoulderY, Math.abs(leftElbow.x - leftShoulder.x)) * 180 / Math.PI;
            
            let position;
            if (armAngle > 80) {
                position = 'up';
            } else if (armAngle < 30) {
                position = 'down';
            } else {
                position = 'middle';
            }
            
            // Count push-ups based on state transitions
            if (pushupState === 'up' && position === 'down') {
                pushupState = 'down';
            } else if (pushupState === 'down' && position === 'up') {
                pushupState = 'up';
                pushupCount++;
                updatePushupUI();
                
                // Update statistics
                pushupStats.currentSet = pushupCount;
                if (pushupCount > pushupStats.bestSet) {
                    pushupStats.bestSet = pushupCount;
                }
            } else if (pushupState === 'ready' && position === 'up') {
                pushupState = 'up';
            }
            
            return {
                position,
                armAngle,
                formQuality: calculatePushupForm(landmarks)
            };
        }

        function calculatePushupForm(landmarks) {
            // Simple form assessment based on body alignment
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            const leftAnkle = landmarks[27];
            const rightAnkle = landmarks[28];
            
            // Check if body is straight (plank-like)
            const shoulderCenter = { x: (leftShoulder.x + rightShoulder.x) / 2, y: (leftShoulder.y + rightShoulder.y) / 2 };
            const hipCenter = { x: (leftHip.x + rightHip.x) / 2, y: (leftHip.y + rightHip.y) / 2 };
            const ankleCenter = { x: (leftAnkle.x + rightAnkle.x) / 2, y: (leftAnkle.y + rightAnkle.y) / 2 };
            
            // Calculate deviation from straight line
            const bodyDeviation = Math.abs((hipCenter.y - shoulderCenter.y) - (ankleCenter.y - hipCenter.y));
            const formScore = Math.max(0, 100 - bodyDeviation * 1000);
            
            return Math.round(formScore);
        }

        function onPushupResults(results) {
            pushupCanvas.width = pushupVideo.videoWidth;
            pushupCanvas.height = pushupVideo.videoHeight;
            
            pushupCtx.clearRect(0, 0, pushupCanvas.width, pushupCanvas.height);
            
            if (results.poseLandmarks) {
                const analysis = analyzePushup(results.poseLandmarks);
                drawPushupSkeleton(results.poseLandmarks, analysis.position);
                updatePushupFeedback(analysis);
            } else {
                showPushupStatus('Position your full body in frame', 'alert');
            }
        }

        function drawPushupSkeleton(landmarks, position) {
            let color;
            switch(position) {
                case 'up': color = '#00ff88'; break;
                case 'down': color = '#ff6b6b'; break;
                default: color = '#ffcc00';
            }
            
            pushupCtx.strokeStyle = color;
            pushupCtx.lineWidth = 3;
            pushupCtx.lineCap = 'round';
            
            // Draw main body connections
            const connections = [
                [11, 12], // Shoulders
                [11, 13], [13, 15], // Left arm
                [12, 14], [14, 16], // Right arm
                [11, 23], [12, 24], // Torso
                [23, 24], // Hips
                [23, 25], [25, 27], // Left leg
                [24, 26], [26, 28]  // Right leg
            ];
            
            connections.forEach(([start, end]) => {
                if (landmarks[start] && landmarks[end]) {
                    pushupCtx.beginPath();
                    pushupCtx.moveTo(landmarks[start].x * pushupCanvas.width, landmarks[start].y * pushupCanvas.height);
                    pushupCtx.lineTo(landmarks[end].x * pushupCanvas.width, landmarks[end].y * pushupCanvas.height);
                    pushupCtx.stroke();
                }
            });
            
            // Draw key points
            pushupCtx.fillStyle = color;
            [11, 12, 13, 14, 15, 16, 23, 24].forEach(i => {
                if (landmarks[i]) {
                    pushupCtx.beginPath();
                    pushupCtx.arc(
                        landmarks[i].x * pushupCanvas.width,
                        landmarks[i].y * pushupCanvas.height,
                        5, 0, 2 * Math.PI
                    );
                    pushupCtx.fill();
                }
            });
        }

        function updatePushupFeedback(analysis) {
            const statusText = {
                'up': '⬆️ Push Up Position',
                'down': '⬇️ Push Down Position', 
                'middle': '🔄 Transitioning'
            };
            
            pushupStatus.textContent = statusText[analysis.position] || 'Get in position';
            pushupStatus.className = `exercise-status ${analysis.position}`;
            
            // Update form quality
            document.getElementById('formQuality').textContent = analysis.formQuality + '%';
            
            if (analysis.formQuality > 80) {
                pushupFeedback.innerHTML = '✅ Good form!';
                pushupFeedback.style.display = 'block';
            } else if (analysis.formQuality > 60) {
                pushupFeedback.innerHTML = '⚠️ Keep body straight';
                pushupFeedback.style.display = 'block';
            } else {
                pushupFeedback.innerHTML = '❌ Improve form: straight line from head to feet';
                pushupFeedback.style.display = 'block';
            }
        }

        function updatePushupUI() {
            pushupCounter.textContent = pushupCount;
            document.getElementById('pushupCount').textContent = pushupCount;
            document.getElementById('currentSet').textContent = pushupCount;
            document.getElementById('bestSet').textContent = pushupStats.bestSet;
        }

        function showPushupStatus(message, type = 'alert') {
            if (!message) {
                pushupStatusMessage.innerHTML = '';
                return;
            }
            
            let className = 'alert-box';
            if (type === 'error') className += ' error';
            if (type === 'success') className += ' success';
            
            pushupStatusMessage.innerHTML = `<div class="${className}">${message}</div>`;
        }

        async function startPushupCamera() {
            try {
                showPushupStatus('Initializing push-up counter...', 'alert');
                
                if (!pushupPose) {
                    initPushupPose();
                }
                
                pushupCamera = new Camera(pushupVideo, {
                    onFrame: async () => {
                        if (pushupPose) {
                            await pushupPose.send({image: pushupVideo});
                        }
                    },
                    width: 1280,
                    height: 720,
                    facingMode: 'user'
                });
                
                await pushupCamera.start();
                
                startPushupBtn.disabled = true;
                stopPushupBtn.disabled = false;
                resetPushupBtn.disabled = false;
                
                pushupCount = 0;
                pushupState = 'ready';
                updatePushupUI();
                
                showPushupStatus('✅ Push-up counter active - Get in starting position', 'success');
                setTimeout(() => showPushupStatus(''), 3000);
                
            } catch (error) {
                console.error('Push-up camera error:', error);
                showPushupStatus('❌ Failed to start camera. Please ensure camera permissions are granted.', 'error');
            }
        }

        function stopPushupCamera() {
            if (pushupCamera) {
                pushupCamera.stop();
                pushupCamera = null;
            }
            
            if (pushupPose) {
                pushupPose.close();
                pushupPose = null;
            }
            
            if (pushupVideo.srcObject) {
                pushupVideo.srcObject.getTracks().forEach(track => track.stop());
                pushupVideo.srcObject = null;
            }
            
            pushupCtx.clearRect(0, 0, pushupCanvas.width, pushupCanvas.height);
            
            startPushupBtn.disabled = false;
            stopPushupBtn.disabled = true;
            resetPushupBtn.disabled = true;
            
            pushupFeedback.style.display = 'none';
            showPushupStatus('Push-up counter stopped', 'alert');
        }

        function resetPushupCount() {
            pushupCount = 0;
            pushupState = 'ready';
            updatePushupUI();
            showPushupStatus('Count reset', 'alert');
            setTimeout(() => showPushupStatus(''), 2000);
        }

        // Push-up event listeners
        startPushupBtn.addEventListener('click', startPushupCamera);
        stopPushupBtn.addEventListener('click', stopPushupCamera);
        resetPushupBtn.addEventListener('click', resetPushupCount);
        
        // Squat event listeners
        startSquatBtn.addEventListener('click', startSquatCamera);
        stopSquatBtn.addEventListener('click', stopSquatCamera);
        resetSquatBtn.addEventListener('click', resetSquatCount);
        
        // Plank event listeners
        startPlankBtn.addEventListener('click', startPlankCamera);
        stopPlankBtn.addEventListener('click', stopPlankCamera);
        resetPlankBtn.addEventListener('click', resetPlankTimer);
        
        // Initialize
        window.addEventListener('load', () => {
            showStatus('Click "Start Camera" to begin posture analysis', 'alert');
            
            // Initialize settings UI
            updateSettingsUI();
            
            // Load and display session history
            updateSessionHistoryDisplay();
            
            // Initialize analytics
            setTimeout(() => {
                initAnalytics();
                // Track page load
                trackEvent('app_loaded', {
                    user_agent: navigator.userAgent,
                    screen_resolution: `${screen.width}x${screen.height}`,
                    theme: settings.theme,
                    break_reminders_enabled: settings.breakReminders,
                    timestamp: new Date().toISOString()
                });
            }, 500);
        });
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            // Stop all cameras and clean up resources
            try {
                if (camera) stopCamera();
                if (pushupCamera) stopPushupCamera();
                if (squatCamera) stopSquatCamera();
                if (plankCamera) stopPlankCamera();
            } catch (e) {
                console.warn('Error during cleanup:', e);
            }
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === ' ' && !calibrateBtn.disabled) {
                e.preventDefault();
                calibratePosture();
            }
            if (e.key === 'Escape' && !stopBtn.disabled) {
                stopCamera();
            }
        });

        // Squat Functions
        function initSquatPose() {
            squatPose = new Pose({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1635988162/${file}`;
                }
            });
            
            squatPose.setOptions({
                modelComplexity: 1,
                smoothLandmarks: true,
                enableSegmentation: false,
                smoothSegmentation: false,
                minDetectionConfidence: 0.5,
                minTrackingConfidence: 0.5
            });
            
            squatPose.onResults(onSquatResults);
        }
        
        function startSquatCamera() {
            if (!squatPose) {
                initSquatPose();
            }
            
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    squatVideo.srcObject = stream;
                    squatCamera = new Camera(squatVideo, {
                        onFrame: async () => {
                            await squatPose.send({image: squatVideo});
                        },
                        width: 640,
                        height: 480
                    });
                    squatCamera.start();
                    
                    startSquatBtn.disabled = true;
                    stopSquatBtn.disabled = false;
                    resetSquatBtn.disabled = false;
                    
                    squatCount = 0;
                    squatState = 'ready';
                    updateSquatUI();
                    
                    showSquatStatus('✅ Squat counter active - Stand up straight to begin', 'success');
                    setTimeout(() => showSquatStatus(''), 3000);
                })
                .catch(err => {
                    console.error('Error accessing camera:', err);
                    alert('Unable to access camera. Please ensure camera permissions are granted.');
                });
        }
        
        function stopSquatCamera() {
            if (squatCamera) {
                squatCamera.stop();
                squatCamera = null;
            }
            
            if (squatPose) {
                squatPose.close();
                squatPose = null;
            }
            
            if (squatVideo.srcObject) {
                squatVideo.srcObject.getTracks().forEach(track => track.stop());
                squatVideo.srcObject = null;
            }
            
            squatCtx.clearRect(0, 0, squatCanvas.width, squatCanvas.height);
            
            startSquatBtn.disabled = false;
            stopSquatBtn.disabled = true;
            resetSquatBtn.disabled = true;
            
            squatFeedback.style.display = 'none';
            showSquatStatus('Squat counter stopped', 'alert');
        }
        
        function resetSquatCount() {
            squatCount = 0;
            squatState = 'ready';
            updateSquatUI();
            showSquatStatus('Count reset', 'alert');
            setTimeout(() => showSquatStatus(''), 2000);
        }
        
        function onSquatResults(results) {
            if (!results.poseLandmarks) return;
            
            // Set canvas dimensions to match video
            squatCanvas.width = squatVideo.videoWidth;
            squatCanvas.height = squatVideo.videoHeight;
            
            // Clear canvas
            squatCtx.clearRect(0, 0, squatCanvas.width, squatCanvas.height);
            
            // Draw pose landmarks
            drawConnectors(squatCtx, results.poseLandmarks, POSE_CONNECTIONS, {color: '#00FF00', lineWidth: 2});
            drawLandmarks(squatCtx, results.poseLandmarks, {color: '#FF0000', lineWidth: 2});
            
            // Analyze squat movement
            const squatAnalysis = analyzeSquatMovement(results.poseLandmarks);
            
            if (squatAnalysis) {
                updateSquatMetrics(squatAnalysis);
                provideLiveSquatFeedback(squatAnalysis);
            }
        }
        
        function analyzeSquatMovement(landmarks) {
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            const leftKnee = landmarks[25];
            const rightKnee = landmarks[26];
            const leftAnkle = landmarks[27];
            const rightAnkle = landmarks[28];
            
            if (!leftHip || !rightHip || !leftKnee || !rightKnee || !leftAnkle || !rightAnkle) {
                return null;
            }
            
            // Calculate knee angles
            const leftKneeAngle = calculateAngle(leftHip, leftKnee, leftAnkle);
            const rightKneeAngle = calculateAngle(rightHip, rightKnee, rightAnkle);
            const avgKneeAngle = (leftKneeAngle + rightKneeAngle) / 2;
            
            // Calculate hip height
            const hipHeight = (leftHip.y + rightHip.y) / 2;
            const kneeHeight = (leftKnee.y + rightKnee.y) / 2;
            
            // Determine position
            let position;
            if (avgKneeAngle > 160) {
                position = 'up';
            } else if (avgKneeAngle < 120) {
                position = 'down';
            } else {
                position = 'middle';
            }
            
            // Count squats
            if (squatState === 'ready' && position === 'down') {
                squatState = 'down';
            } else if (squatState === 'down' && position === 'up') {
                squatState = 'up';
                squatCount++;
                updateSquatUI();
                
                // Update statistics
                squatStats.currentSet = squatCount;
                if (squatCount > squatStats.bestSet) {
                    squatStats.bestSet = squatCount;
                }
            } else if (squatState === 'ready' && position === 'up') {
                squatState = 'up';
            }
            
            // Calculate form scores
            const depthScore = Math.max(0, Math.min(100, (160 - avgKneeAngle) / 40 * 100));
            const formScore = calculateSquatForm(landmarks);
            
            squatStats.depthQuality = Math.round(depthScore);
            squatStats.formScore = Math.round(formScore);
            
            return {
                position,
                kneeAngle: avgKneeAngle,
                hipHeight,
                depthScore,
                formScore
            };
        }
        
        function calculateSquatForm(landmarks) {
            let formScore = 100;
            
            // Check knee alignment
            const leftKnee = landmarks[25];
            const rightKnee = landmarks[26];
            const leftAnkle = landmarks[27];
            const rightAnkle = landmarks[28];
            
            if (leftKnee && rightKnee && leftAnkle && rightAnkle) {
                const kneeToAnkleLeft = Math.abs(leftKnee.x - leftAnkle.x);
                const kneeToAnkleRight = Math.abs(rightKnee.x - rightAnkle.x);
                
                if (kneeToAnkleLeft > 0.05 || kneeToAnkleRight > 0.05) {
                    formScore -= 20; // Knee valgus penalty
                }
            }
            
            return Math.max(0, formScore);
        }
        
        function updateSquatUI() {
            squatCounter.textContent = squatCount;
            document.getElementById('squatSession').textContent = squatCount;
            document.getElementById('squatBest').textContent = squatStats.bestSet;
            document.getElementById('squatTotal').textContent = squatStats.totalToday;
            document.getElementById('squatFormScore').textContent = squatStats.formScore + '%';
            document.getElementById('squatDepth').textContent = squatStats.depthQuality + '%';
        }
        
        function updateSquatMetrics(analysis) {
            // Update real-time metrics display
            document.getElementById('squatFormScore').textContent = Math.round(analysis.formScore) + '%';
            document.getElementById('squatDepth').textContent = Math.round(analysis.depthScore) + '%';
        }
        
        function provideLiveSquatFeedback(analysis) {
            let feedback = '';
            
            if (analysis.position === 'down' && analysis.depthScore < 50) {
                feedback = '⬇️ Go deeper!';
            } else if (analysis.position === 'down' && analysis.depthScore > 80) {
                feedback = '✅ Perfect depth!';
            } else if (analysis.formScore < 70) {
                feedback = '⚠️ Check knee alignment';
            } else if (squatState === 'up') {
                feedback = '💪 Great squat!';
            }
            
            if (feedback) {
                squatFeedback.textContent = feedback;
                squatFeedback.style.display = 'block';
                setTimeout(() => {
                    squatFeedback.style.display = 'none';
                }, 2000);
            }
        }
        
        function showSquatStatus(message, type = 'alert') {
            squatStatus.textContent = message;
            squatStatus.className = `exercise-status ${type}`;
        }
        
        // Plank Functions
        function initPlankPose() {
            plankPose = new Pose({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1635988162/${file}`;
                }
            });
            
            plankPose.setOptions({
                modelComplexity: 1,
                smoothLandmarks: true,
                enableSegmentation: false,
                smoothSegmentation: false,
                minDetectionConfidence: 0.5,
                minTrackingConfidence: 0.5
            });
            
            plankPose.onResults(onPlankResults);
        }
        
        function startPlankCamera() {
            if (!plankPose) {
                initPlankPose();
            }
            
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    plankVideo.srcObject = stream;
                    plankCamera = new Camera(plankVideo, {
                        onFrame: async () => {
                            await plankPose.send({image: plankVideo});
                        },
                        width: 640,
                        height: 480
                    });
                    plankCamera.start();
                    
                    startPlankBtn.disabled = true;
                    stopPlankBtn.disabled = false;
                    resetPlankBtn.disabled = false;
                    
                    plankStartTime = null;
                    plankCurrentTime = 0;
                    plankIsActive = false;
                    updatePlankUI();
                    
                    showPlankStatus('✅ Plank timer active - Get into plank position', 'success');
                    setTimeout(() => showPlankStatus(''), 3000);
                })
                .catch(err => {
                    console.error('Error accessing camera:', err);
                    alert('Unable to access camera. Please ensure camera permissions are granted.');
                });
        }
        
        function stopPlankCamera() {
            if (plankCamera) {
                plankCamera.stop();
                plankCamera = null;
            }
            
            if (plankPose) {
                plankPose.close();
                plankPose = null;
            }
            
            if (plankVideo.srcObject) {
                plankVideo.srcObject.getTracks().forEach(track => track.stop());
                plankVideo.srcObject = null;
            }
            
            if (plankIsActive) {
                plankIsActive = false;
                const currentTime = plankCurrentTime;
                plankStats.totalTime += currentTime;
                if (currentTime > plankStats.bestTime) {
                    plankStats.bestTime = currentTime;
                }
            }
            
            plankCtx.clearRect(0, 0, plankCanvas.width, plankCanvas.height);
            
            startPlankBtn.disabled = false;
            stopPlankBtn.disabled = true;
            resetPlankBtn.disabled = true;
            
            plankFeedback.style.display = 'none';
            showPlankStatus('Plank timer stopped', 'alert');
        }
        
        function resetPlankTimer() {
            plankStartTime = null;
            plankCurrentTime = 0;
            plankIsActive = false;
            updatePlankUI();
            showPlankStatus('Timer reset', 'alert');
            setTimeout(() => showPlankStatus(''), 2000);
        }
        
        function onPlankResults(results) {
            if (!results.poseLandmarks) return;
            
            // Set canvas dimensions to match video
            plankCanvas.width = plankVideo.videoWidth;
            plankCanvas.height = plankVideo.videoHeight;
            
            // Clear canvas
            plankCtx.clearRect(0, 0, plankCanvas.width, plankCanvas.height);
            
            // Draw pose landmarks
            drawConnectors(plankCtx, results.poseLandmarks, POSE_CONNECTIONS, {color: '#00FF00', lineWidth: 2});
            drawLandmarks(plankCtx, results.poseLandmarks, {color: '#FF0000', lineWidth: 2});
            
            // Analyze plank position
            const plankAnalysis = analyzePlankPosition(results.poseLandmarks);
            
            if (plankAnalysis) {
                updatePlankMetrics(plankAnalysis);
                provideLivePlankFeedback(plankAnalysis);
                
                // Start/stop timer based on plank position
                if (plankAnalysis.isValidPlank && !plankIsActive) {
                    plankStartTime = Date.now();
                    plankIsActive = true;
                    showPlankStatus('⏱️ Timer started!', 'success');
                } else if (!plankAnalysis.isValidPlank && plankIsActive) {
                    plankIsActive = false;
                    const sessionTime = plankCurrentTime;
                    plankStats.totalTime += sessionTime;
                    if (sessionTime > plankStats.bestTime) {
                        plankStats.bestTime = sessionTime;
                    }
                    showPlankStatus('⏸️ Timer paused - get back in position', 'alert');
                }
                
                // Update current time
                if (plankIsActive) {
                    plankCurrentTime = (Date.now() - plankStartTime) / 1000;
                    updatePlankUI();
                }
            }
        }
        
        function analyzePlankPosition(landmarks) {
            const nose = landmarks[0];
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            const leftAnkle = landmarks[27];
            const rightAnkle = landmarks[28];
            
            if (!nose || !leftShoulder || !rightShoulder || !leftHip || !rightHip) {
                return null;
            }
            
            // Calculate body alignment
            const shoulderY = (leftShoulder.y + rightShoulder.y) / 2;
            const hipY = (leftHip.y + rightHip.y) / 2;
            const bodySlope = Math.abs(shoulderY - hipY);
            
            // Check if in plank position (relatively straight line)
            const isValidPlank = bodySlope < 0.1 && shoulderY > 0.3 && hipY > 0.3;
            
            // Calculate form scores
            const alignmentScore = Math.max(0, 100 - (bodySlope * 1000));
            const stabilityScore = calculatePlankStability(landmarks);
            
            plankStats.formScore = Math.round(alignmentScore);
            plankStats.stabilityScore = Math.round(stabilityScore);
            
            return {
                isValidPlank,
                bodySlope,
                alignmentScore,
                stabilityScore
            };
        }
        
        function calculatePlankStability(landmarks) {
            // Simple stability calculation based on shoulder position consistency
            // In a real implementation, you'd track movement over time
            return Math.random() * 20 + 80; // Placeholder for now
        }
        
        function updatePlankUI() {
            const timeStr = formatTime(plankCurrentTime);
            plankTimer.textContent = timeStr;
            document.getElementById('plankCurrent').textContent = timeStr;
            document.getElementById('plankBest').textContent = formatTime(plankStats.bestTime);
            document.getElementById('plankTotal').textContent = formatTime(plankStats.totalTime);
            document.getElementById('plankFormScore').textContent = plankStats.formScore + '%';
            document.getElementById('plankStability').textContent = plankStats.stabilityScore + '%';
        }
        
        function updatePlankMetrics(analysis) {
            document.getElementById('plankFormScore').textContent = Math.round(analysis.alignmentScore) + '%';
            document.getElementById('plankStability').textContent = Math.round(analysis.stabilityScore) + '%';
        }
        
        function provideLivePlankFeedback(analysis) {
            let feedback = '';
            
            if (!analysis.isValidPlank) {
                feedback = '⚠️ Get into plank position';
            } else if (analysis.alignmentScore < 70) {
                feedback = '📏 Keep body straight';
            } else if (analysis.stabilityScore < 70) {
                feedback = '💪 Hold steady';
            } else if (plankIsActive) {
                feedback = '✅ Perfect plank!';
            }
            
            if (feedback) {
                plankFeedback.textContent = feedback;
                plankFeedback.style.display = 'block';
            }
        }
        
        function showPlankStatus(message, type = 'alert') {
            plankStatus.textContent = message;
            plankStatus.className = `exercise-status ${type}`;
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Signup functionality
        let liveUsersCount = 247;
        let totalUsersCount = 12847;
        let todaySessionsCount = 3291;
        let improvementsCount = 89234;
        
        function updateLiveStats() {
            // Only update if we're on the signup page
            if (currentPage !== 'signup') return;
            
            // More realistic time-based fluctuations
            const hour = new Date().getHours();
            const isPeakHours = (hour >= 8 && hour <= 10) || (hour >= 17 && hour <= 21); // Morning/evening peaks
            
            // Online users fluctuate based on time of day
            let baseUsers = isPeakHours ? 280 : 220;
            let fluctuation = Math.floor(Math.random() * 41) - 20; // -20 to +20
            liveUsersCount = Math.max(180, Math.min(350, baseUsers + fluctuation));
            
            // Correlate new signups with online users (higher online = more likely signups)
            const signupProbability = liveUsersCount > 250 ? 0.4 : 0.25;
            if (Math.random() < signupProbability) {
                totalUsersCount += Math.floor(Math.random() * 3) + 1;
                
                // When someone signs up, slightly increase other metrics
                if (Math.random() < 0.6) {
                    todaySessionsCount += Math.floor(Math.random() * 2) + 1;
                }
                if (Math.random() < 0.3) {
                    improvementsCount += Math.floor(Math.random() * 8) + 2;
                }
            }
            
            // Independent session increases (people using the app)
            if (Math.random() < 0.5) {
                todaySessionsCount += Math.floor(Math.random() * 4) + 1;
            }
            
            // Improvements grow slower but more meaningfully
            if (Math.random() < 0.15) {
                const improvementBurst = Math.floor(Math.random() * 15) + 5;
                improvementsCount += improvementBurst;
            }
            
            // Add some occasional "spikes" to make it feel more organic
            if (Math.random() < 0.05) { // 5% chance of spike
                const spikeType = Math.random();
                if (spikeType < 0.33) {
                    liveUsersCount += Math.floor(Math.random() * 30) + 10;
                } else if (spikeType < 0.66) {
                    todaySessionsCount += Math.floor(Math.random() * 50) + 20;
                } else {
                    improvementsCount += Math.floor(Math.random() * 100) + 50;
                }
            }
            
            // Animate number changes
            const liveUsersEl = document.getElementById('liveUsers');
            const totalUsersEl = document.getElementById('totalUsers');
            const todaySessionsEl = document.getElementById('todaySessions');
            const improvementsEl = document.getElementById('improvements');
            
            if (liveUsersEl && liveUsersEl.textContent != liveUsersCount) {
                liveUsersEl.style.transform = 'scale(1.1)';
                liveUsersEl.style.color = '#10b981';
                setTimeout(() => {
                    liveUsersEl.textContent = liveUsersCount;
                    liveUsersEl.style.transform = 'scale(1)';
                    setTimeout(() => {
                        liveUsersEl.style.color = '#10b981';
                    }, 200);
                }, 150);
            }
            
            if (totalUsersEl && parseInt(totalUsersEl.textContent.replace(/,/g, '')) !== totalUsersCount) {
                totalUsersEl.style.transform = 'scale(1.05)';
                totalUsersEl.style.color = '#06b6d4';
                setTimeout(() => {
                    totalUsersEl.textContent = totalUsersCount.toLocaleString();
                    totalUsersEl.style.transform = 'scale(1)';
                    setTimeout(() => {
                        totalUsersEl.style.color = '#3b82f6';
                    }, 200);
                }, 100);
            }
            
            if (todaySessionsEl && parseInt(todaySessionsEl.textContent.replace(/,/g, '')) !== todaySessionsCount) {
                todaySessionsEl.style.transform = 'scale(1.05)';
                todaySessionsEl.style.color = '#8b5cf6';
                setTimeout(() => {
                    todaySessionsEl.textContent = todaySessionsCount.toLocaleString();
                    todaySessionsEl.style.transform = 'scale(1)';
                    setTimeout(() => {
                        todaySessionsEl.style.color = '#3b82f6';
                    }, 200);
                }, 100);
            }
            
            if (improvementsEl && parseInt(improvementsEl.textContent.replace(/,/g, '')) !== improvementsCount) {
                improvementsEl.style.transform = 'scale(1.05)';
                improvementsEl.style.color = '#f59e0b';
                setTimeout(() => {
                    improvementsEl.textContent = improvementsCount.toLocaleString();
                    improvementsEl.style.transform = 'scale(1)';
                    setTimeout(() => {
                        improvementsEl.style.color = '#3b82f6';
                    }, 200);
                }, 100);
            }
        }
        
        // Update stats with more realistic timing
        function scheduleNextUpdate() {
            // More frequent updates during peak hours
            const hour = new Date().getHours();
            const isPeakHours = (hour >= 8 && hour <= 10) || (hour >= 17 && hour <= 21);
            const baseInterval = isPeakHours ? 2000 : 4000; // 2-4s base interval
            const randomInterval = Math.random() * 6000 + baseInterval; // Add 0-6s variation
            
            setTimeout(() => {
                updateLiveStats();
                scheduleNextUpdate();
            }, randomInterval);
        }
        
        scheduleNextUpdate();
        
        // Enhanced realistic names database with censoring
        const fakeNames = [
            // Regular names
            'Alex Chen', 'Sarah Johnson', 'Michael Rodriguez', 'Emma Davis', 'James Wilson',
            'Jessica Martinez', 'David Thompson', 'Lisa Wang', 'Robert Kim', 'Amanda Taylor',
            'Christopher Brown', 'Ashley Garcia', 'Matthew Miller', 'Rachel Green', 'Daniel Lewis',
            'Jennifer Hall', 'Mark Young', 'Laura Anderson', 'Paul White', 'Maria Lopez',
            'Kevin Martinez', 'Nicole Clark', 'Steven Wright', 'Megan Thomas', 'Anthony Hill',
            'Samantha Walker', 'Ryan Scott', 'Catherine King', 'Joshua Adams', 'Amy Nelson',
            'Brandon Carter', 'Rebecca Mitchell', 'Jacob Perez', 'Michelle Roberts', 'Tyler Moore',
            'Stephanie Taylor', 'Justin Jackson', 'Kimberly White', 'Andrew Martin', 'Elizabeth Thompson',
            
            // Tech/Modern names
            'Kai Patel', 'Zoe Chen', 'Lucas Kim', 'Aria Singh', 'Ethan Zhang',
            'Maya Johnson', 'Noah Williams', 'Sophia Martinez', 'Liam Davis', 'Isabella Garcia',
            'Oliver Brown', 'Charlotte Wilson', 'Elijah Jones', 'Amelia Miller', 'William Moore',
            'Harper Taylor', 'Benjamin Anderson', 'Evelyn Thomas', 'Mason Jackson', 'Abigail White',
            'Logan Martin', 'Emily Lee', 'Alexander Thompson', 'Madison Clark', 'Sebastian Lewis',
            'Avery Walker', 'Jack Robinson', 'Ella Hall', 'Owen Young', 'Scarlett King',
            
            // International names
            'Hiroshi Tanaka', 'Priya Sharma', 'Ahmed Hassan', 'Elena Rodriguez', 'Viktor Petrov',
            'Fatima Al-Zahra', 'Carlos Silva', 'Yuki Nakamura', 'Ananya Gupta', 'Marco Rossi',
            'Ingrid Larsson', 'Diego Martinez', 'Amara Okafor', 'Dmitri Volkov', 'Lila Patel',
            'Francesco Romano', 'Aisha Khan', 'Henrik Nielsen', 'Camila Santos', 'Raj Mehta',
            
            // Censored names (realistic censoring patterns)
            'J**** S****', 'M**** R*******z', 'A***a D****', 'R**** W****n',
            'S***h J*****n', 'D**** T*****n', 'L*** W***', 'C***s B****',
            'E*** M*****r', 'T*** A*****n', 'K*** P****', 'N**** C****',
            'B***n K***', 'G*** L***s', 'H***y T****r', 'P*** S****h',
            'Q***n W****e', 'V***a G****a', 'X***r H****s', 'Z*** Y****',
            'J****e M****n', 'K****n L***s', 'A****w C****k', 'M****e W*****r',
            'S****n R****t', 'T****a P****z', 'U*** S****v', 'W****m T****s',
            'A***a K***g', 'B***e N****n', 'C****e O****r', 'D***a P****r',
            'E***n Q****n', 'F***k R*****s', 'G***e S*****h', 'H***n T****r',
            
            // More regular names
            'Austin Cooper', 'Brooke Murphy', 'Caleb Rivera', 'Diana Cook', 'Eric Bailey',
            'Faith Reed', 'Gabriel Ward', 'Hannah Torres', 'Ian Peterson', 'Julia Gray',
            'Kyle Ramirez', 'Leah Watson', 'Marcus Brooks', 'Natalie Kelly', 'Oscar Sanders',
            'Paige Price', 'Quinton Bennett', 'Ruby Wood', 'Shane Barnes', 'Tiffany Ross',
            'Victor Henderson', 'Wendy Coleman', 'Xavier Jenkins', 'Yasmin Perry', 'Zachary Powell',
            
            'Adrian Foster', 'Bella Hughes', 'Connor Flores', 'Destiny Stewart', 'Eli Morris',
            'Fiona Rogers', 'Griffin Reed', 'Haley Cox', 'Isaac Ward', 'Jade Rivera',
            'Knox Bailey', 'Luna Gray', 'Milo Watson', 'Nora Brooks', 'Orion Kelly',
            'Piper Sanders', 'Quinn Price', 'Ryder Bennett', 'Sage Wood', 'Theo Barnes',
            
            // Tech industry inspired
            'Ava Blockchain', 'Byte Johnson', 'Code Martinez', 'Data Wilson', 'Echo Chen',
            'Flux Rodriguez', 'Grid Thompson', 'Hash Kim', 'Index Patel', 'Json Lee',
            'Kube Singh', 'Link Davis', 'Mesh Garcia', 'Node Brown', 'Orbit Miller',
            
            // Fitness inspired  
            'Flex Martin', 'Grace Strong', 'Hunter Fit', 'Iris Active', 'Jax Cardio',
            'Kira Wellness', 'Lance Trainer', 'Maya Pilates', 'Nova Crossfit', 'Opal Yoga',
            
            // More censored variations
            'A****r B****t', 'C****a D*****s', 'E****h F*****r', 'G****l H*****s',
            'I****c J*****n', 'K****n L*****z', 'M****a N*****l', 'O****r P*****k',
            'Q****e R*****o', 'S****e T*****y', 'U****a V*****z', 'W****r X*****g',
            'Y****a Z*****i', 'A***e C****r', 'D***k F****h', 'G***n I****s',
            'J***r L****n', 'M***y O****t', 'P***l R****d', 'S***a U****k',
            'T***s W****m', 'V***i Z****e', 'B***n E****y', 'F***a H****l',
            'K***o M****s', 'N***h Q****r', 'R***d T****v', 'X***m A****n',
            
            // Location-inspired names
            'Brooklyn Vale', 'Denver Cross', 'Phoenix Wright', 'Austin Rivers', 'Charlotte Stone',
            'Dallas Moon', 'Houston Star', 'Miami Beach', 'Orlando Sky', 'Tampa Bay',
            'Seattle Rain', 'Portland Rose', 'Vegas Gold', 'Reno Silver', 'Aspen Snow',
            
            // Creative/Artistic names
            'Canvas Wright', 'Melody Chord', 'Rhythm Beat', 'Sketch Palette', 'Story Write',
            'Verse Poem', 'Dance Flow', 'Paint Brush', 'Clay Sculpt', 'Film Reel',
            'Photo Snap', 'Music Note', 'Art Create', 'Design Shape', 'Color Bright',
            
            // Nature inspired
            'River Stone', 'Forest Green', 'Ocean Blue', 'Mountain Peak', 'Valley Deep',
            'Canyon Wide', 'Desert Sand', 'Prairie Wind', 'Lake Clear', 'Stream Flow',
            'Meadow Bloom', 'Garden Rose', 'Field Grass', 'Tree Oak', 'Leaf Pine',
            
            // More international with censoring
            'R****o S****a', 'Y****i N*****a', 'P****a S****a', 'A****d H****n',
            'E****a R*******z', 'V****r P****v', 'F****a A*****a', 'C****s S****a',
            'M****o R****i', 'I****d L*****n', 'D****o M*******z', 'A****a O****r',
            'D****i V****v', 'L*** P****', 'F*******o R****o', 'A****a K***',
            'H****k N*****n', 'C****a S****s', 'R** M****', 'L*** C***',
            
            // Tech company inspired (censored)
            'G****e A*****m', 'A****n C****g', 'M****t D*****r', 'A****e I*****n',
            'T****a E*******r', 'N****x S*****r', 'S****y P*****r', 'U****r D****r',
            'L****n L*****r', 'T****r U****r', 'I****m P*****r', 'S****k C*****r',
            'D****d T*****r', 'Z*** M*****r', 'F****k C*****r', 'T****k U****r',
            
            // Gaming inspired + Meme names
            'Player One', 'Gamer Pro', 'Quest Hero', 'Level Max', 'Score High',
            'Pixel Art', 'Combo Strike', 'Power Up', 'Boss Fight', 'Game Over',
            'xX_NoScope_Xx', 'MLG_Doritos', '360NoSlump', 'Get_Rekt_Posture', 'DeezNuts_Spine',
            'SussyBaka420', 'AmongUs_Back', 'Crewmate_Core', 'Impostor_Spine', 'Vent_Cleaner',
            'Poggers_Posture', 'Pepega_Spine', 'MonkaS_Back', 'Kekw_Posture', 'EZ_Clap_Spine',
            'Chad_Thundercock', 'Virgin_Walker', 'Stacy_Spine', 'Karen_Posture', 'Kyle_Back',
            
            // Fitness goals inspired
            'Goal Setter', 'Progress Track', 'Habit Build', 'Strong Will', 'Flex Time',
            'Core Power', 'Mind Body', 'Health First', 'Fit Life', 'Active Day',
            
            // More realistic everyday names with censoring mix
            'J****n B****r', 'K****y M*****r', 'L****n W*****n', 'N****e G*****z',
            'S****n R*****s', 'T****a L*****z', 'A****w H*****s', 'B****a T*****r',
            'C****e A*****n', 'D****l M*****z', 'E****h W*****s', 'F****k J*****n',
            'G****e D*****s', 'H****h B*****n', 'I****a S*****h', 'J****a P*****z',
            
            // Professional titles as names (modern trend)
            'Dr. Smith', 'Prof. Johnson', 'Coach Martinez', 'Trainer Lee', 'Chef Rodriguez',
            'Artist Chen', 'Writer Kim', 'Designer Patel', 'Developer Singh', 'Manager Davis',
            
            // Username-style names (realistic for online platforms)
            'FitFan2024', 'HealthyLife99', 'PosturePro', 'WorkoutWin', 'ActiveAce',
            'FlexMaster', 'CoreStrong', 'FitGoals', 'HealthHub', 'WellnessWin',
            'GymLife24', 'FitTrack99', 'HealthyMe', 'ActiveLife', 'StrongCore',
            
            // Funny/Meme usernames
            'sadboi69', 'xxPOSTUREGODxx', 'BackPainBegone', 'SlouchLord420', 'StraightSpine_',
            'xXSpineAlignXx', 'PostureCheck99', 'SlumpDestroyer', 'ErgoWarrior666', 'BackBender2024',
            'FlexOnHaters', 'SpinalTapped', 'ChairSlayer', 'DeskDefeater', 'BackCrack_Master',
            'YeetTheSlump', 'NoMoreOof', 'SpineTime69', 'PostureBae', 'BackPain_No_More',
            'Flex_Appeal', 'Stand_Tall_bb', 'Chair_Enemy', 'Posture_Police', 'Spine_Soldier',
            'BackBeastMode', 'PostureGang', 'SlouchSlayer', 'Chair_Warrior', 'Desk_Destroyer',
            'FlexLord2024', 'SpineCheck_', 'BackBossBabe', 'PosturePrincess', 'FlexKing420',
            'No_Slouch_Zone', 'StraightUpFlex', 'PosturePro_', 'BackBendQueen', 'SpineGuard',
            'FlexMeister', 'PostureVibes', 'BackAttack2024', 'SpineMaster69', 'FlexableAF',
            'PostureQueen_', 'BackBendy', 'SpineAlert99', 'FlexGod2024', 'NoSlouchLife',
            
            // More international names
            'Akira Sato', 'Bharti Sharma', 'Chen Wei', 'Dmitri Kozlov', 'Elena Popov',
            'Fatou Diallo', 'Giovanni Bianchi', 'Hassan Ali', 'Ines Silva', 'Jose Gutierrez',
            'Kwame Asante', 'Layla Mansour', 'Miguel Torres', 'Nadia Petrov', 'Omar Hassan',
            'Priscilla Santos', 'Qasim Rahman', 'Rashid Abdullah', 'Sofia Andersson', 'Tariq Khan',
            'Uma Reddy', 'Valentina Costa', 'Wei Zhang', 'Xander Novak', 'Yasmina Belkacem',
            'Zara Okonkwo', 'Abdullah Ahmed', 'Beatrice Larsson', 'Chin-Yu Lin', 'Deepak Mehta',
            'Esther Okafor', 'Fabio Rossi', 'Gemma O\'Brien', 'Hamza Benali', 'Isabelle Dubois',
            
            // More creative censored patterns (including funny ones)
            'A•••• B••••', 'C•••• D••••', 'E•••• F••••', 'G•••• H••••',
            'I•••• J••••', 'K•••• L••••', 'M•••• N••••', 'O•••• P••••',
            'Q•••• R••••', 'S•••• T••••', 'U•••• V••••', 'W•••• X••••',
            'Y•••• Z••••', 'A••• B•••', 'C••• D•••', 'E••• F•••',
            'G••• H•••', 'I••• J•••', 'K••• L•••', 'M••• N•••',
            
            // Censored funny usernames
            's****i69', 'xX****GODXx', 'Back****Gone', 'S****d420', 'Flex****ters',
            'Y***TheSlump', 'Post****ae', 'Sp***69', 'No****Oof', '****Lord2024',
            'Ch***layer', 'D***eater', 'B***tMode', 'Pos****ng', 'F***ble69',
            'NoS****ife', 'Str****ex', 'B***ndy', 'F***d2024', 'Sp***ert99',
            
            // More realistic meme/gaming names
            'GigaChad2024', 'Based_Posture', 'Sigma_Spine', 'Chad_Back', 'Alpha_Align',
            'Beta_Bend', 'Virgin_Slouch', 'Gamer_Posture', 'MLG_Spine', 'Pro_Align420',
            'Epic_Ergonomics', 'Legendary_Lumbar', 'Mythic_Muscles', 'Elite_Ergo',
            'Master_Muscle', 'Diamond_Desk', 'Platinum_Posture', 'Gold_Gamer',
            'Silver_Spine', 'Bronze_Back', 'Iron_Posture', 'Copper_Core',
            
            // Mix of full and partially censored
            'Jennifer M***', 'Michael R***', 'Jessica L***', 'David W***', 'Sarah K***',
            'Christopher B***', 'Ashley G***', 'Matthew T***', 'Amanda H***', 'Daniel S***',
            'Lisa P***', 'Mark C***', 'Laura A***', 'Ryan M***', 'Nicole R***',
            'Kevin L***', 'Megan T***', 'Brandon C***', 'Rebecca P***', 'Justin H***'
        ];
        
        function addNewUser() {
            // Only add if we're on the signup page
            if (currentPage !== 'signup') return;
            
            const userList = document.querySelector('.user-list');
            if (!userList) return;
            
            const userItems = userList.querySelectorAll('.user-item');
            
            // Smoothly fade out the last user before removing
            if (userItems.length >= 5) {
                const lastUser = userItems[userItems.length - 1];
                lastUser.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                lastUser.style.opacity = '0';
                lastUser.style.transform = 'translateX(20px)';
                setTimeout(() => {
                    if (lastUser.parentNode) {
                        lastUser.remove();
                    }
                }, 300);
            }
            
            // Create new user with random realistic details
            const name = fakeNames[Math.floor(Math.random() * fakeNames.length)];
            const initial = name.includes('•') || name.includes('*') ? 
                name.charAt(0) : // For censored names, use first letter
                name.split(' ')[0].charAt(0); // For regular names, use first name initial
            
            // Add some variety to join statuses
            const joinStatuses = [
                'Just joined', 'Joined now', 'New member', 'Recently joined', 
                'Just signed up', 'Welcome!', 'New to community'
            ];
            const status = joinStatuses[Math.floor(Math.random() * joinStatuses.length)];
            
            const newUser = document.createElement('div');
            newUser.className = 'user-item';
            newUser.style.opacity = '0';
            newUser.style.transform = 'translateY(-20px) scale(0.95)';
            newUser.style.transition = 'all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)';
            
            // Vary avatar colors for more realism
            const avatarColors = [
                'linear-gradient(135deg, #3b82f6, #8b5cf6)',
                'linear-gradient(135deg, #10b981, #059669)',
                'linear-gradient(135deg, #f59e0b, #d97706)',
                'linear-gradient(135deg, #ef4444, #dc2626)',
                'linear-gradient(135deg, #8b5cf6, #7c3aed)',
                'linear-gradient(135deg, #06b6d4, #0891b2)'
            ];
            const avatarColor = avatarColors[Math.floor(Math.random() * avatarColors.length)];
            
            newUser.innerHTML = `
                <div class="user-avatar" style="background: ${avatarColor}">${initial}</div>
                <div class="user-info">
                    <div class="user-name">${name}</div>
                    <div class="user-status">${status}</div>
                </div>
                <div class="online-indicator"></div>
            `;
            
            // Insert at the beginning with staggered animation
            const firstUser = userList.querySelector('.user-item');
            if (firstUser) {
                firstUser.parentNode.insertBefore(newUser, firstUser);
            } else {
                userList.appendChild(newUser);
            }
            
            // Animate in with bounce effect
            setTimeout(() => {
                newUser.style.opacity = '1';
                newUser.style.transform = 'translateY(0) scale(1)';
            }, 50);
            
            // Add a brief highlight effect
            setTimeout(() => {
                newUser.style.background = 'rgba(59, 130, 246, 0.1)';
                newUser.style.borderColor = 'rgba(59, 130, 246, 0.3)';
                setTimeout(() => {
                    newUser.style.background = 'rgba(30, 41, 59, 0.3)';
                    newUser.style.borderColor = 'rgba(59, 130, 246, 0.1)';
                }, 1500);
            }, 500);
            
            // Update timestamps for existing users with slight delay for realism
            setTimeout(() => {
                updateUserTimestamps();
            }, 200);
            
            // Occasionally trigger a stat increase when someone joins (correlation)
            if (Math.random() < 0.3) {
                setTimeout(() => {
                    totalUsersCount += 1;
                    updateLiveStats();
                }, 800);
            }
        }
        
        function updateUserTimestamps() {
            if (currentPage !== 'signup') return;
            
            const userItems = document.querySelectorAll('.user-item');
            const timestamps = ['Just joined', '5 minutes ago', '12 minutes ago', '28 minutes ago', '1 hour ago'];
            
            userItems.forEach((item, index) => {
                const statusElement = item.querySelector('.user-status');
                if (statusElement && index < timestamps.length) {
                    statusElement.textContent = timestamps[index];
                }
            });
        }
        
        // Add new users with more realistic timing
        function scheduleNextUser() {
            const hour = new Date().getHours();
            const isPeakHours = (hour >= 8 && hour <= 10) || (hour >= 17 && hour <= 21);
            
            // More frequent signups during peak hours
            const baseDelay = isPeakHours ? 8000 : 20000; // 8-20s base
            const randomDelay = Math.random() * (isPeakHours ? 15000 : 25000); // Add 15-25s variation
            const totalDelay = baseDelay + randomDelay; // Total: 8-23s peak, 20-45s off-peak
            
            setTimeout(() => {
                if (currentPage === 'signup') {
                    addNewUser();
                }
                scheduleNextUser(); // Schedule the next one
            }, totalDelay);
        }
        
        // Start the user addition cycle
        scheduleNextUser();
        
        // Automatically increase stats over time (static growth)
        function continuousStatGrowth() {
            if (currentPage !== 'signup') {
                setTimeout(continuousStatGrowth, 10000); // Check again in 10s
                return;
            }
            
            // Gradual base increases every 30-60 seconds
            const growthInterval = Math.random() * 30000 + 30000; // 30-60 seconds
            
            setTimeout(() => {
                // Always increase total users slowly
                totalUsersCount += Math.floor(Math.random() * 2) + 1;
                
                // Increase sessions more frequently
                todaySessionsCount += Math.floor(Math.random() * 8) + 3;
                
                // Improvements grow in bursts
                if (Math.random() < 0.7) { // 70% chance
                    improvementsCount += Math.floor(Math.random() * 25) + 10;
                }
                
                // Trigger visual updates
                updateLiveStats();
                
                // Schedule next growth cycle
                continuousStatGrowth();
            }, growthInterval);
        }
        
        // Start continuous growth
        continuousStatGrowth();
        
        // Additional periodic stat boosts (larger jumps)
        function periodicStatBoosts() {
            if (currentPage !== 'signup') {
                setTimeout(periodicStatBoosts, 60000); // Check again in 1 minute
                return;
            }
            
            // Every 2-5 minutes, bigger stat increases
            const boostInterval = Math.random() * 180000 + 120000; // 2-5 minutes
            
            setTimeout(() => {
                // Simulate "viral moments" or "feature launches"
                const boostType = Math.random();
                
                if (boostType < 0.4) {
                    // User signup surge
                    totalUsersCount += Math.floor(Math.random() * 15) + 5;
                    todaySessionsCount += Math.floor(Math.random() * 30) + 15;
                } else if (boostType < 0.7) {
                    // Session activity surge
                    todaySessionsCount += Math.floor(Math.random() * 50) + 25;
                    improvementsCount += Math.floor(Math.random() * 80) + 40;
                } else {
                    // Improvement achievement surge
                    improvementsCount += Math.floor(Math.random() * 150) + 75;
                    liveUsersCount = Math.min(350, liveUsersCount + Math.floor(Math.random() * 20) + 10);
                }
                
                updateLiveStats();
                periodicStatBoosts(); // Schedule next boost
            }, boostInterval);
        }
        
        // Start periodic boosts
        periodicStatBoosts();
        
        // Handle signup form submission
        document.addEventListener('DOMContentLoaded', () => {
            const signupForm = document.getElementById('signupForm');
            if (signupForm) {
                signupForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const submitBtn = document.querySelector('.signup-btn');
                    if (submitBtn) {
                        submitBtn.textContent = 'Creating Account...';
                        submitBtn.disabled = true;
                        
                        setTimeout(() => {
                            alert('Account created successfully! Welcome to the community!');
                            submitBtn.textContent = 'Account Created!';
                            submitBtn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                            
                            // Reset form
                            setTimeout(() => {
                                this.reset();
                                submitBtn.textContent = 'Create Account';
                                submitBtn.disabled = false;
                                submitBtn.style.background = 'linear-gradient(135deg, #3b82f6, #8b5cf6)';
                            }, 2000);
                        }, 2000);
                    }
                });
            }
        });
    </script>
</body>
</html>